<!DOCTYPE html>
<html>
  <head>
<link rel="stylesheet" type="text/css" href="http://wcfcourier.com/app/special/data_tables/media/css/demo_page.css">
<link rel="stylesheet" type="text/css" href="http://wcfcourier.com/app/special/data_tables/media/css/demo_table.css">

<script type="text/javascript" language="javascript" src="http://wcfcourier.com/app/special/data_tables/media/js/jquery.js"></script>
<script type="text/javascript" language="javascript" src="http://wcfcourier.com/app/special/data_tables/media/js/jquery.js"></script>
<script type="text/javascript" language="javascript" src="http://wcfcourier.com/app/special/data_tables/media/js/jquery.dataTables.min.js"></script>
<script src="js/Chart.js"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Minnesota Prison Demographics</title>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.9/d3.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.9/d3.min.js"></script>
<script src="//cdn.jsdelivr.net/underscorejs/1.6.0/underscore-min.map"></script>
<script src="//cdn.jsdelivr.net/underscorejs/1.6.0/underscore-min.js"></script>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<!-- Optional theme -->
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
<!-- Latest compiled and minified JavaScript -->
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>


<script>
$(function() {
    function count($this){
        var current = parseInt($this.html(), 10);
        $this.html(++current);
        if(current !== $this.data('count')){
            setTimeout(function(){count($this)}, 10);
        }
    }        
  $("span").each(function() {
      $(this).data('count', parseInt($(this).html(), 10));
      $(this).html('0');
      count($(this));
  });
});
</script>

    <style type="text/css">
      body { 
        background-color: white;
      }
      circle {
        stroke: none;
        stroke-width: 2px;
        opacity: .8;
      }
      circle:hover {
        stroke: black;
        stroke-width: 2px;
        opacity: .8;
      }
      .btn-group {
        margin-left: 0;
      }
.btn-primary{
background-image: linear-gradient(to bottom,#e0e0e0 0,#e0e0e0 100%) !important;
background-color: #e0e0e0 !important;
border:none;
box-shadow:none !important;
font-size:1em;
padding:6px 12px 6px 12px;
color:#000;
}

.btn-primary input[type=radio]{
display:none !important;
}

.btn-primary:hover{
background-image: linear-gradient(to bottom,#666 0,#666 100%) !important;
color:#eee !important;
background-color: #666 !important;
border-size: 2px;
border-color: #fff !important;
box-shadow: none !important;
}

.btn-primary:checked{
background-image: linear-gradient(to bottom,#999 0,#999 100%) !important;
color:#fff !important;
background-color: #999 !important;
border-radius: 0 !important;
border-size: 2px;
border-color: #fff !important;
box-shadow: none !important;
}

.btn-group{
margin:auto !important;
}

.active{
background-image: linear-gradient(to bottom,#000 0,#000 100%) !important;
color:#efefef !important;
background-color: #000 !important;
}
      .label {
        fill: black;
        font-size: 16px;
      }

body { 
margin:0; 
padding:0; 
font-family: Popular, sans-serif;
overflow:hidden; zoom: 90%;
}

#chart{
width:50%;
display:block;
}

#chart2{
width:50%;
display:none;
}

label{
padding-top:20px;
}

.container {
    display: table;
width:100%
    }
  #row  {
    display: table-row;
    }

  #left, #right, #middle {
    display: table-cell;
width:50% !important;
    }
#medical_chart{
background-color:#999999;
}
#gear_chart{
background-color:#999999;
}
#weapons_chart{
background-color:#999999;
}
#vehicles_chart{
background-color:#999999;
}
#comm_chart{
background-color:#999999;
}
#clothing_chart{
background-color:#999999;
}

    </style>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-45101494-1']);
    _gaq.push(['_setDomainName', 'delimited.io']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>


  </head>
  <body>
    <div class="btn-group" data-toggle="buttons">
      <label class="btn btn-primary" id="id" value="0">
        <input type="radio" name="options" id="id" value="0" onchange="setVisibility('chart','block');setVisibility('chart2','none');">All
      </label>
      <label class="btn btn-primary active" id="party" value="1">
        <input type="radio" name="options" value="1" onchange="setVisibility('chart','block');setVisibility('chart2','none');">By Category
      </label>
    </div>
<div id="chart"></div>

<div id="chart2">

</div>


<script>
function setVisibility(id, visibility) {
document.getElementById(id).style.display = visibility;
}
</script>
    <script>
      d3.csv('data/surplus.csv', function (error, data) {

        var width = 800, height = 900;
        var fill = d3.scale.ordinal().range(['#da6867','#9c2726','#b02c2b','#c53130','#d03f3e','#d55453','#872221'])
        var svg = d3.select("#chart").append("svg")
            .attr("width", width)
            .attr("height", height);

        for (var j = 0; j < data.length; j++) {
          data[j].radius = +data[j].size / 5;
          data[j].x = Math.random() * width;
          data[j].y = Math.random() * height;
        }

        var padding = 4;
        var maxRadius = d3.max(_.pluck(data, 'radius'));


        var getCenters = function (vname, size) {
          var centers, map;
          centers = _.uniq(_.pluck(data, vname)).map(function (d) {
            return {name: d, value: 1};
          });

          map = d3.layout.pack().size(size);
          map.nodes({children: centers});

          return centers;
        };

        var nodes = svg.selectAll("circle")
          .data(data);

        nodes.enter().append("circle")
          .attr("class", "node")
          .attr("cx", function (d) { return d.x; })
          .attr("cy", function (d) { return d.y; })
          .attr("r", 2)
          .style("fill", function (d) { return fill(d.party); })
          .on("mouseover", function (d) { showPopover.call(this, d); })
          .on("mouseout", function (d) { removePopovers(); })

        nodes.transition().duration(1000)
          .attr("r", function (d) { return d.radius; })

        var force = d3.layout.force();

        draw('party');

        $( ".btn" ).click(function() {
          draw(this.id);
        });

        function draw (varname) {
          var centers = getCenters(varname, [630, 630]);
          force.on("tick", tick(centers, varname));
          labels(centers)
          force.start();
        }

        function tick (centers, varname) {
          var foci = {};
          for (var i = 0; i < centers.length; i++) {
            foci[centers[i].name] = centers[i];
          }
          return function (e) {
            for (var i = 0; i < data.length; i++) {
              var o = data[i];
              var f = foci[o[varname]];
              o.y += (f.y - o.y) * e.alpha;
              o.x += (f.x - o.x) * e.alpha;
            }
            nodes.each(collide(.11))
              .attr("cx", function (d) { return d.x; })
              .attr("cy", function (d) { return d.y; });
          }
        }

        function labels (centers) {
          svg.selectAll(".label").remove();

          svg.selectAll(".label")
          .data(centers).enter().append("text")
          .attr("class", "label")
          .text(function (d) { return d.name })
          .attr("transform", function (d) {
            return "translate(" + (d.x - ((d.name.length)*3)) + ", " + (d.y - d.r) + ")";
          });
        }

        function removePopovers () {
          $('.popover').each(function() {
            $(this).remove();
          }); 
        }

        function showPopover (d) {
          $(this).popover({
            placement: 'auto top',
            container: 'body',
            trigger: 'manual',
            html : true,
            content: function() { 
              return d.quantity + " " + d.item + "<br />Value: " + d.value; }
          });
          $(this).popover('show')
        }

        function collide(alpha) {
          var quadtree = d3.geom.quadtree(data);
          return function(d) {
            var r = d.radius + maxRadius + padding,
                nx1 = d.x - r,
                nx2 = d.x + r,
                ny1 = d.y - r,
                ny2 = d.y + r;
            quadtree.visit(function(quad, x1, y1, x2, y2) {
              if (quad.point && (quad.point !== d)) {
                var x = d.x - quad.point.x,
                    y = d.y - quad.point.y,
                    l = Math.sqrt(x * x + y * y),
                    r = d.radius + quad.point.radius + padding;
                if (l < r) {
                  l = (l - r) / l * alpha;
                  d.x -= x *= l;
                  d.y -= y *= l;
                  quad.point.x += x;
                  quad.point.y += y;
                }
              }
              return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;
            });
          };
        }
      });
    </script>

    <script>
      d3.csv('data/surplus2.csv', function (error, data) {

        var width = 800, height = 800;
        var fill = d3.scale.ordinal().range(['#FDC68A','#F49AC2','#7EA7D8','#A2D39C','#7BCDC8','#A187BE','#F7977A'])
        var svg = d3.select("#chart2").append("svg")
            .attr("width", width)
            .attr("height", height);

        for (var j = 0; j < data.length; j++) {
          data[j].radius = +data[j].size / 5;
          data[j].x = Math.random() * width;
          data[j].y = Math.random() * height;
        }

        var padding = 4;
        var maxRadius = d3.max(_.pluck(data, 'radius'));


        var getCenters = function (vname, size) {
          var centers, map;
          centers = _.uniq(_.pluck(data, vname)).map(function (d) {
            return {name: d, value: 1};
          });

          map = d3.layout.pack().size(size);
          map.nodes({children: centers});

          return centers;
        };

        var nodes = svg.selectAll("circle")
          .data(data);

        nodes.enter().append("circle")
          .attr("class", "node")
          .attr("cx", function (d) { return d.x; })
          .attr("cy", function (d) { return d.y; })
          .attr("r", 2)
          .style("fill", function (d) { return fill(d.party); })
          .on("mouseover", function (d) { showPopover.call(this, d); })
          .on("mouseout", function (d) { removePopovers(); })

        nodes.transition().duration(1000)
          .attr("r", function (d) { return d.radius; })

        var force = d3.layout.force();

        draw('id');

        $( ".btn" ).click(function() {
          draw(this.id);
        });

        function draw (varname) {
          var centers = getCenters(varname, [700, 500]);
          force.on("tick", tick(centers, varname));
          labels(centers)
          force.start();
        }

        function tick (centers, varname) {
          var foci = {};
          for (var i = 0; i < centers.length; i++) {
            foci[centers[i].name] = centers[i];
          }
          return function (e) {
            for (var i = 0; i < data.length; i++) {
              var o = data[i];
              var f = foci[o[varname]];
              o.y += (f.y - o.y) * e.alpha;
              o.x += (f.x - o.x) * e.alpha;
            }
            nodes.each(collide(.11))
              .attr("cx", function (d) { return d.x; })
              .attr("cy", function (d) { return d.y; });
          }
        }

        function labels (centers) {
          svg.selectAll(".label").remove();

          svg.selectAll(".label")
          .data(centers).enter().append("span").append("text")
          .attr("class", "label")
          .text(function (d) { return d.name })
          .attr("transform", function (d) {
            return "translate(" + (d.x - ((d.name.length)*3)) + ", " + (d.y - d.r) + ")";
          });
        }

        function removePopovers () {
          $('.popover').each(function() {
            $(this).remove();
          }); 
        }

        function showPopover (d) {
          $(this).popover({
            placement: 'auto top',
            container: 'body',
            trigger: 'manual',
            html : true,
            content: function() { 
              return d.item; }
          });
          $(this).popover('show')
        }

        function collide(alpha) {
          var quadtree = d3.geom.quadtree(data);
          return function(d) {
            var r = d.radius + maxRadius + padding,
                nx1 = d.x - r,
                nx2 = d.x + r,
                ny1 = d.y - r,
                ny2 = d.y + r;
            quadtree.visit(function(quad, x1, y1, x2, y2) {
              if (quad.point && (quad.point !== d)) {
                var x = d.x - quad.point.x,
                    y = d.y - quad.point.y,
                    l = Math.sqrt(x * x + y * y),
                    r = d.radius + quad.point.radius + padding;
                if (l < r) {
                  l = (l - r) / l * alpha;
                  d.x -= x *= l;
                  d.y -= y *= l;
                  quad.point.x += x;
                  quad.point.y += y;
                }
              }
              return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;
            });
          };
        }
      });
    </script>
  </body>
</html>