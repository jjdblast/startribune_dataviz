<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Adverse Medical Events Database</title>
  <meta name="description" content="Adverse Medical Events Database">
  <meta name="author" content="Frey Hargarten - StarTribune">

  <link rel="stylesheet" href="../_common_resources/styles/startribune_dataviz_styles.css" />
  <link rel="stylesheet" href="../_common_resources/js/datatables-master/DataTables-1.10.12/css/jquery.dataTables.min.css" /> 
  <link rel="stylesheet" href="../_common_resources/js/datatables-master/Responsive-2.1.0/css/responsive.dataTables.min.css" />
  <link href="../_common_resources/charts/c3-master/c3.css" rel="stylesheet" type="text/css">
  
  <style>
     #wrapper { width:100%; }
     .dataTable { min-height:500px; }
     .dataTables_info { display:block !important; font-family: "Benton Sans",Helvetica,Arial,sans-serif; }

     @media (max-width:420px) {
    .dataTable { min-height:70px; }
     }

  </style> 
</head>

<body>
<div id="wrapper">

<div class="chartTitle">Hospitals with 6+ adverse events in 2015</div>
<div class="chatter">Data spans 12-month period ending Oct. 6, 2015.</div>
<div id="chart"></div>

<div class="chartTitle">Search the stateâ€™s database by hospital or by adverse event</div>
<div class="chatter">Data contains events reported between 2004 and 2016.</div>
<table width="100%" cellspacing="0" class="display compact responsive nowrap" id="events"><thead><tr><th>Year</th><th>Hospital</th><th>City</th><th>Event</th><th>Incidents</th><th>Deaths</th><th>Injuries</th><th>Type</th></tr></thead></table>
<!-- 
<a href='https://docs.google.com/spreadsheets/d/1jvziIFqm2fkcTgpigumWV2aM8XBPy6SjxE5_pAt9BII/pub?output=csv' target='new_'><button class='downloadButton'>&#9660; Download Data</button></a> -->

  </div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<script src="../_common_resources/js/d3-master/d3.min.js" charset="utf-8"></script>
<script src='../_common_resources/js/datatables-master/datatables.min.js'></script>
<script src="../_common_resources/js/datatables-master/Responsive-2.1.0/js/datatables.responsive.js"></script>
<script src="../_common_resources/charts/c3-master/c3.min.js"></script>

<script>
d3.json("./data/events.json", function(error, json) {
d3.json("./data/summary.json", function(error, json2) {

var data = json.events;
var dataChart = json2.sum;

// CHART
var  padding = {
        top: 20,
        right: 40,
        bottom: 20,
        left: 270,
    };

var chartDecade = c3.generate({
        bindto: '#chart',
        size: { height: 600 },
        padding: padding,
        data: {
            json: dataChart,
            keys: {
                x: 'hospital',
                value: ['count']
            },
            names: {
              'count': 'Number of Adverse Events'
            },
            types: {
            'count': 'bar'
            }
        },
       bar: {
        width: {
            ratio: 0.5 // this makes bar width 50% of length between ticks
        }
      },
        axis: {
          rotated: true,
          y: {
            tick: {
             values: ['0', '20', '35'],
             format: d3.format('r')
            }
        },
        x: {
            type: 'category',
            tick: {
                // format: '%Y',
                multiline: false
            }
          }
        },
      subchart: { show: false },
        color: { pattern: ['#CCC'] },
    });


//TABLE
  $(document).ready(function() {

           var eventsTable = $('#events').DataTable( {
                responsive: {
        details: {
            type: 'row'
        }
    },
                "bServerSide":false,
                "bProcessing":true,
                "sAjaxDataProp": "feed.entry",
                "order": [[ 0, "desc" ]],
                "oLanguage": {"sSearch": ""},
                "sAjaxSource": "https://spreadsheets.google.com/feeds/list/1jvziIFqm2fkcTgpigumWV2aM8XBPy6SjxE5_pAt9BII/od6/public/values?&alt=json",
                "aoColumns": [                 
                    { "mDataProp": "gsx$year.$t" },
                    { "mDataProp": "gsx$hospital.$t" },
                    { "mDataProp": "gsx$city.$t" },
                    { "mDataProp": "gsx$category.$t" },
                    { "mDataProp": "gsx$number.$t" },
                    { "mDataProp": "gsx$death.$t" },
                    { "mDataProp": "gsx$injury.$t" },
                    { "mDataProp": "gsx$catcode.$t" },
                            ]
            } );

    $('.dataTables_filter input').attr("placeholder", "Enter keyword");

        } );

    $(".dataTable").removeClass("nowrap");

});
});
</script>
</body>
</html>