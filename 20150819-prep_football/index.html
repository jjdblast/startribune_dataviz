<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Prep Football Districts</title>
  <meta name="description" content="Prep Football Districts">
  <meta name="author" content="Jeff Hargarten - StarTribune">

  <link href='https://api.tiles.mapbox.com/mapbox.js/v2.2.1/mapbox.css' rel='stylesheet' />
  <link rel="stylesheet" href="../_common_resources/startribune_dataviz_styles.css" />
  
<style>
  body { margin:0; padding:0; overflow-x:hidden; font-family:"Benton Sans",Helvetica,Arial,sans-serif; }
  #map { height:800px; width:65%; display:inline-block; }
  .mapbox-logo, .leaflet-control-attribution{ display:none !important; }
  .map-legend .swatch { width:20px; height:20px; float:left; margin-right:10px; }
  .leaflet-popup-close-button { display: none; }
  .leaflet-popup-content-wrapper { pointer-events: none; }
  #button { text-align:center; width:310px; margin-right:auto; margin-left:auto; }
  #right_rail { float:right; display:inline-block; width:30%; }
  .districtLabel { width:100%; font-family:"Benton Sans",Helvetica,Arial,sans-serif; font-weight:900; margin:7px; padding:5px; }
  .districtLabel:hover { cursor:pointer; }
  #button { padding:10px; }
  .downloadButton { display:none !important; }

  .switch { padding:10px; display:inline-block; text-align:center; width:150px; background-color:#fff; font-weight:900; font-family:"Benton Sans",Helvetica,Arial,sans-serif; border:1px solid black; }
  .switch:hover, .selected { background-color:#333 !important; color:#fff !important; cursor:pointer; margin-bottom:4px; margin-top:4px; }

  @media only screen and (max-width:650px) {
  #map { float:none; width:100%; }
  #right_rail { float:none; width:100%; text-align:center; }
  }
</style>

</head>

<body>

<div id="wrapper">

<div id="map"></div>

<div id="right_rail">
<div id="button">
<button id="state" class='switch selected'>State View</button>
<button id="metro" class='switch'>Metro Area</button>
</div>

<div class="districtLabel" style="color:#7CC7FF">West Metro</div> 
<div class="districtLabel" style="color:#4178BE">East Metro</div> 
<div class="districtLabel" style="color:#264A60">Twin City</div> 
<div class="districtLabel" style="color:#152935">Suburban</div> 

<div class="districtLabel" style="color:#0A3C02">Southwest</div> 
<div class="districtLabel" style="color:#144D14">Southeast</div> 
<div class="districtLabel" style="color:#4B8400">Mid Southeast</div> 
<div class="districtLabel" style="color:#B4E051">Big Southeast</div> 

<div class="districtLabel" style="color:#005448">Midwest</div> 
<div class="districtLabel" style="color:#41D6C3">Mid State</div> 

<div class="districtLabel" style="color:#311A41">Northwest</div> 
<div class="districtLabel" style="color:#9855D4">Northeast</div> 

<div class="districtLabel" style="color:#3A0B2E">South Central</div> 
<div class="districtLabel" style="color:#7C1C58">North Central</div> 
<div class="districtLabel" style="color:#FF3CA0">East Central</div> 

<div class="districtLabel" style="color:#4C0A17">9 - West</div> 
<div class="districtLabel" style="color:#8C101C">9 - South</div> 
<div class="districtLabel" style="color:#E71D32">9 - North</div> 


</div>

<div class="breaker"></div>

<a href='https://docs.google.com/spreadsheets/d/1TFaDqK7Q_YZ1ucWCdB8snFQrlGiRtA4hOpcDBW0KrGg/pub?output=xlsx' target='new_'><button class='downloadButton'>&#9660; Download Data</button></a>
</div>

</body>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script src='https://api.tiles.mapbox.com/mapbox.js/v2.2.1/mapbox.js'></script>
<script src='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.2.0/leaflet-omnivore.min.js'></script>
<script src="http://d3js.org/d3.v3.min.js"></script>

<script>
//LIVE JSON MAGIC

//https://script.google.com/macros/s/AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu/exec?id=1TFaDqK7Q_YZ1ucWCdB8snFQrlGiRtA4hOpcDBW0KrGg&sheet=districts

// $jsonData = file_get_contents("https://script.googleusercontent.com/macros/echo?user_content_key=3H15wwkLvI0fcVkgEOpIxL4Z-WQzBhPwRrgE4c-G0mmYV_eDWyyZiZrgx0Dn1a67ESsHfNHRT8gqJngjE_Ezh2Yp4-AEGShJOJmA1Yb3SEsKFZqtv3DaNYcMrmhZHmUMWojr9NvTBuBLhyHCd5hHaxCoMjMSmZWLp6XAShvjQj50JtCfh4yP7n1RnEoDeOH7XqmOXgX8RYIyMAhIAtjnF9UDzNXGLr6THvj8nhwyf7HquKh-yCje2smCxo-567jG9MKKlG-RzX16oe7mbg5yHyGBE13DvETm3dzJzZTV7Gje_hBp2hW1OA&lib=MVcLnEUipyThKZcpmQKyqT_CoSfd4egCX");

// var dataLoad = <?php echo $jsonData; ?>

d3.json("http://googlescript.startribune.com/?macro=AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu&id=1TFaDqK7Q_YZ1ucWCdB8snFQrlGiRtA4hOpcDBW0KrGg&sheet=districts", function(error, dataLoad) {

var data = dataLoad.districts;

$(".switch").click(function() {
  $(".switch").removeClass("selected");
  $(this).addClass("selected");
});

//INITIALIZE MAP
var mapBounds = new L.LatLngBounds(
              new L.LatLng(39.1982, -128.1445),
              new L.LatLng(50.5414, -68.2031));

L.mapbox.accessToken = 'pk.eyJ1Ijoic2hhZG93ZmxhcmUiLCJhIjoiODRHdjBSWSJ9.lF4ymp-69zdGvZ5X4Tokzg';
  var map = L.mapbox.map('map', 'mapbox.light')
    .setView([46.358056, -94.200833], 7);

// map.dragging.disable();
map.touchZoom.disable();
map.doubleClickZoom.disable();
map.scrollWheelZoom.disable();

$(document).ready(function() {

$("#metro").click(function() {
  map.setView([44.983333, -93.266667], 10);
  resetMarkers();
  $(".districtLabel").css("background-color","#fff");
});
$("#state").click(function() {
  map.setView([46.358056, -94.200833], 7);
  resetMarkers();
  $(".districtLabel").css("background-color","#fff");
});
$(".districtLabel").click(function() {
  $(".districtLabel").css("background-color","#fff");
  $(this).css("background-color","#ddd");
  highlightDistrict($(this).text());
});

//MARKER HIGHLIGHTING
function highlightDistrict(district){
 districts.eachLayer(function (layer) { 
    if(layer.feature.properties.district == district) {    
        layer.setStyle({"fillOpacity":1}); 
      }
    else {    
        layer.setStyle({"fillOpacity":0}); 
      }
    });
}

function resetMarkers(){
 districts.eachLayer(function (layer) { 
   layer.setStyle({"fillOpacity":0.3}); 
    });
}

var customLayer = L.geoJson(null, {
    pointToLayer: function(feature, latlon) {
      if (feature.properties.district == "9 - West"){
        return L.circleMarker(latlon, {radius: 7, color:"#4C0A17", weight:1,fillOpacity:0.3});
      }
      else if (feature.properties.district == "9 - South") {
        return L.circleMarker(latlon, {radius: 7, color:"#8C101C", weight:1,fillOpacity:0.3});
      }
      else if (feature.properties.district == "9 - North") {
        return L.circleMarker(latlon, {radius: 7, color:"#E71D32", weight:1,fillOpacity:0.3});
      }
      else if (feature.properties.district == "South Central") {
        return L.circleMarker(latlon, {radius: 7, color:"#3A0B2E", weight:1,fillOpacity:0.3});
      }
      else if (feature.properties.district == "North Central") {
        return L.circleMarker(latlon, {radius: 7, color:"#7C1C58", weight:1,fillOpacity:0.3});
      }
      else if (feature.properties.district == "East Central") {
        return L.circleMarker(latlon, {radius: 7, color:"#FF3CA0", weight:1,fillOpacity:0.3});
      }
      else if (feature.properties.district == "Northwest") {
        return L.circleMarker(latlon, {radius: 7, color:"#311A41", weight:1,fillOpacity:0.3});
      }
      else if (feature.properties.district == "Northeast") {
        return L.circleMarker(latlon, {radius: 7, color:"#9855D4", weight:1,fillOpacity:0.3});
      }
      else if (feature.properties.district == "Midwest") {
        return L.circleMarker(latlon, {radius: 7, color:"#005448", weight:1,fillOpacity:0.3});
      }
      else if (feature.properties.district == "Mid State") {
        return L.circleMarker(latlon, {radius: 7, color:"#41D6C3", weight:1,fillOpacity:0.3});
      }
      else if (feature.properties.district == "Big Southeast") {
        return L.circleMarker(latlon, {radius: 7, color:"#B4E051", weight:1,fillOpacity:0.3});
      }
      else if (feature.properties.district == "Mid Southeast") {
        return L.circleMarker(latlon, {radius: 7, color:"#4B8400", weight:1,fillOpacity:0.3});
      }
      else if (feature.properties.district == "Southeast") {
        return L.circleMarker(latlon, {radius: 7, color:"#144D14", weight:1,fillOpacity:0.3});
      }
      else if (feature.properties.district == "Southwest") {
        return L.circleMarker(latlon, {radius: 7, color:"#0A3C02", weight:1,fillOpacity:0.3});
      }
      else if (feature.properties.district == "Suburban") {
        return L.circleMarker(latlon, {radius: 7, color:"#152935", weight:1,fillOpacity:0.3});
      }
      else if (feature.properties.district == "Twin City") {
        return L.circleMarker(latlon, {radius: 7, color:"#264A60", weight:1,fillOpacity:0.3});
      }
      else if (feature.properties.district == "East Metro") {
        return L.circleMarker(latlon, {radius: 7, color:"#4178BE", weight:1,fillOpacity:0.3});
      }
      else if (feature.properties.district == "West Metro") {
        return L.circleMarker(latlon, {radius: 7, color:"#7CC7FF", weight:1,fillOpacity:0.3});
      }
    }
});

var districts = omnivore.csv('data/FootballData.csv',null,customLayer)
// var districts = omnivore.csv('https://docs.google.com/spreadsheets/d/1TFaDqK7Q_YZ1ucWCdB8snFQrlGiRtA4hOpcDBW0KrGg/export?format=csv&id=1TFaDqK7Q_YZ1ucWCdB8snFQrlGiRtA4hOpcDBW0KrGg&gid=0',null,customLayer)
    .on('click', function(layer) {
        this.eachLayer(function(marker) {
           marker.bindPopup("<div><strong>" + marker.feature.properties.team + "</strong></div><div>District: " + marker.feature.properties.district + "</div><div>Class: " + marker.feature.properties.className + "</div><div>Subdistrict: " + marker.feature.properties.subdistrict + "</div><div>Enrollment: " + marker.feature.properties.enrollment + "</div>");
        });
    }).addTo(map);

});
});
</script>

</html>