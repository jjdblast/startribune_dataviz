
<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Nine charts that explain the state of marijuana in Minnesota</title>
  <meta name="description" content="Nine charts that explain the state of marijuana in Minnesota">
  <meta name="author" content="Jeff Hargarten - StarTribune">

  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="http://stage-www.startribune.com/static/css/screen.css?d=1429128267">
  <link href="js/nvd3-master/src/nv.d3.css" rel="stylesheet" type="text/css">
  <link href="js/jquery.bxslider.css" rel="stylesheet" />
  <link href='https://api.tiles.mapbox.com/mapbox.js/v2.1.8/mapbox.css' rel='stylesheet' />

<style>
    .background { fill: none; pointer-events: all; }
    #states { fill: #aaa; }
    #state-borders { fill: none; stroke: #fff; stroke-width: 2px; stroke-linejoin: round; stroke-linecap: round; pointer-events: none; }
    .tooltip{ background-color:rgba(255,255,255,1); height: auto; width: auto; padding:10px; -webkit-border-radius:10px; -moz-border-radius:10px; border-radius:0; border: 1px solid black; font-size:12px; font-family:Arial; }
    .d3-tip { line-height: 1; font-weight: bold; padding: 12px; background: rgba(0, 0, 0, 0.8); color: #fff; border-radius: 2px; }
    .d3-tip:after { box-sizing: border-box; display: inline; font-size: 10px; width: 100%; line-height: 1; color: rgba(0, 0, 0, 0.8); content: "\25BC";  position: absolute; text-align: center; }
    .d3-tip.n:after { margin: -1px 0 0 0; top: 100%; left: 0; }
    #states .active { fill: #333 !important; fill-opacity: 1 !important; }
    #timeline{font-weight:900;}
    .legend label, .legend span { display:block; float:left; height:15px; width:30PX; text-align:center; font-size:11px; color:#808080; }
    #legalQ.legend label, #legalQ.legend span { display:block; float:left; height:15px; width:100px !important; text-align:center; font-size:12px; color:#fff; padding:10px; padding-top:20px; font-weight:bold; }

    .myButton { background-color:#61bd1a; -moz-border-radius:16px; -webkit-border-radius:16px; border-radius:3px; border:0; display:inline-block; cursor:pointer; color:#ffffff; font-family:arial; font-size:16px; padding:13px 26px; text-decoration:none;  font-weight:900; width:32.6%; }
    .myButton:active { background-color:#333; }
    .downloadButton { background-color:#61bd1a; -moz-border-radius:16px; -webkit-border-radius:16px; border-radius:3px; border:0; display:inline-block; cursor:pointer; color:#ffffff; font-family:arial; font-size:16px; padding:13px; text-decoration:none; font-weight:900; margin:5px; width:200px; }
    .downloadButton:active { background-color:#378f00; }
    .myButton2 { background-color:#61bd1a; -moz-border-radius:16px; -webkit-border-radius:16px; border-radius:3px; border:0;  display:inline-block; cursor:pointer;  color:#ffffff; font-family:arial; font-size:16px; padding:13px 26px; width:13.5%;
      text-decoration:none; font-weight:900; } 
    .myButton2:active { background-color:#333; }
    .myButton3 { background-color:#61bd1a; -moz-border-radius:16px; -webkit-border-radius:16px; border-radius:3px; border:0; display:inline-block; cursor:pointer; color:#ffffff; font-family:arial; font-size:16px; padding:13px 26px; text-decoration:none; font-weight:900; width:49.6%; }
    .myButton3:active { background-color:#333; }
    .myButton_pd { background-color:#61bd1a; -moz-border-radius:16px; -webkit-border-radius:16px; border-radius:3px; border:0; display:inline-block; cursor:pointer; color:#ffffff; font-family:arial; font-size:16px; padding:13px 26px; text-decoration:none; font-weight:900; width:49.6%; }
    .myButton_pd:active { background-color:#333; }
    .myButton4 { background-color:#61bd1a; -moz-border-radius:16px; -webkit-border-radius:16px; border-radius:3px; border:0; display:inline-block; cursor:pointer; color:#ffffff; font-family:arial; font-size:16px; padding:13px 26px; width:15.8%; text-decoration:none; font-weight:900; }
    .myButton4:active { background-color:#333; }
    .myButton5 { background-color:#61bd1a; -moz-border-radius:16px; -webkit-border-radius:16px; border-radius:3px; border:0; display:inline-block; cursor:pointer; color:#ffffff; font-family:arial; font-size:16px; padding:13px 26px; text-decoration:none; font-weight:900; width:49.6%; }
    .myButton5:active { background-color:#333; }

    button:focus {outline:0 !important;}
    #map2 svg{width:100% !important; height:350 !important;}
    #map3{display:none;}
    #chart_mpls {width:100% !important; height:450px !important;}
    #wrapper{width:98%;position:relative;}
    #legend_label{font-weight:900;}
    #color_legend{padding: 10px;}
    #zoom{float:left;text-decoration:none;font-weight:bold;color:steelblue;}
    #reset{float:right;font-size:24px;text-decoration:none;font-weight:999;color:steelblue;margin-right:15px;}
    #sidebox{width:250px !important;float:right;}
    #map{float:left; margin:10px;}
    #infobox{ width:220px !important; border-style: solid; border-color: #eee; border-width: 2px; height:120px; padding:10px; }
    .county_name{font-size:18px; font-family: "Popular"; font-weight:900;}
    .prevalence{font-size:16px; font-family:Arial; padding-top:5px;}
    hr{border:0; border-bottom:1px dashed #aaa; background:#999; clear:both;}
    #infobox h4 {   margin-top: 1.83em; margin-bottom: 1em; margin-left: 0; margin-right: 0; font-weight: 900; }
    .arrow { width: 0; height: 0; border-top: 5px solid transparent; border-bottom: 5px solid transparent; float:left; margin-right:2px; border-left: 5px solid black; }
    #map svg { width:600px !important; height: 470px !important; }
    #chart1 svg { width:100% !important; height: 580px !important; }
    #chart2 svg { width:100% !important; height: 450px !important; }
    #chart_aclu svg{ width:100% !important; height: 580px !important; }

    .nvtooltip { padding:5px; }
    .nvtooltip h3 { margin: 0; padding: 2px; font-weight:bold; text-align:left; background:white !important; font-size:16px; }
    .nvtooltip p { margin: 0; padding: 0; }
    .nvtooltip span { display: inline-block; margin: 2px 0; }
    .nvtooltip-pending-removal { position: absolute; pointer-events: none; }

    #population{float:left;margin:10px; margin-left:70px;}
    #cases{float:right;margin:10px; margin-right:70px;}

    .white{fill:#a1d99b;}
    .black{fill:#a1d99b;}
    .hispanic{fill:#a1d99b;}
    .indian{fill:#a1d99b;}
    .asian{fill:#a1d99b;}
    .other{fill:#a1d99b;} 
    .faded { fill-opacity: 0.5 !important; }
    .selected{ text-decoration:none !important; color:black !important; font-weight:900; opacity:1 !important; }
    .selected{fill:#333 !important;}
    .selectedButton{background-color:#333 !important;}
    .metric{font-weight:bold;line-height:150%;font-size:43px;}
    .num{font-weight:900;line-height:150%;font-size:43px;}
    .pct{font-weight:900;line-height:150%;margin-right:28px;font-size:43px;}
    .state-groups text { font-family: sans-serif; font-size: 9px; fill: #fff; cursor:default; font-weight:bold !important; }
    .state-groups:hover{ opacity:.5 !important; }
    .state-groups text{ font-size: 12px !important; }
    .dq0 { fill:#333; color:white !important; pointer-events: all; }
    .dq1 { fill:#999; color:black !important; pointer-events: all; }
    .dq2 { fill:#2b632c; color:white !important; pointer-events: all; }
    .dq3 { fill:#61bd1a; color:white !important; pointer-events: all; }
    .dc { fill:#000; color:white !important; pointer-events: all; }
    .none { fill:#ccc; }

    a { font-weight: 900 !important; }

    #label_us { float:left; width:45%; text-align:center; font-weight:900; font-size:22px; }
    #label_mn { float:right; width:45%; text-align:center; font-weight:900; font-size:22px; }
    #pie_us { float:left; width:45%; }
    #pie_mn { float:right; width:45%; }
    #pie_us svg { with:100%; height:434px; }
    #pie_mn svg { with:100%; height:434px; }
    #chart_us { width:100%; }
    #chart_mn { width:100%;}
    #chart_us svg { with:100%; height:230px; }
    #chart_mn svg { with:100%; height:230px; }
    #chart_pd  svg { with:100%; height:450px; }

    #range {width:100%;}
    .year {width:33%;float:left; text-align:center; font-weight:900; font-size:18px;}
    #states_legend{font-family:arial; font-weight:bold; color:#000; margin-bottom:14px; clear:both;}
    #poll_legend{font-family:arial; font-weight:bold; color:#000; margin-bottom:14px}
    #map_buttons{display:none;}
    .source { font-size:12px !important; color:#ccc !important; }
    .source_link { float:left; padding-top:5px; width:70%;}
    .download { float:right;}
    .source_row {clear:both; height:8px;}
    .download_links { padding-top:10px;}
    #nerdbox{ padding:25px;}
    #credits{ padding:25px; margin-top:20px;}
    .credit_block{float:left; width: 30%; margin-bottom: 10px; }
    #convict{display:none;}
    h3 { font-size:24px;}

    .leaflet-control-attribution{display:none !important;}

    #dispense_map{ width:50%; height:490px; float:left;}
    #icons { width:48%; float:right;}
    .faded2{ fill:#eee !important;}
    .mapbox-logo {display:none;}
    body{ padding:20px; }
    .bx-viewport { padding:10px; padding-right:60px; }
    li { margin:30px; margin-left:30px;}
    .divider{ margin:10px; }
    .leaflet-compact-attribution { display:none; }
    .factoid { font-size:20px; font-weight:bold; padding-top:20px; padding-right:8px;}
    .icon img { width:80px; margin:8px;}
    .icon { padding-top:5px; float:left;}
    .bx-wrapper .bx-pager.bx-default-pager a { background: #ddd !important; }
    .bx-pager.bx-default-pager a.active { background: #61bd1a !important; }
    h3 {margin-bottom:10px;}

    #us_num{position:absolute; top:255px; left:140px; text-align:center;}
    #mn_num{position:absolute; top:255px; right:125px; text-align:center;}
    #us_num h1 { font-size:64px; font-family:"Popular"; font-weight:900; }
    #mn_num h1 { font-size:64px; font-family:"Popular"; font-weight:900; }

    .bottom_fix{ height:210px;}

    .stance { font-size:18px; }

    .nv-indexLine{ display:none !important; }

    #description { text-align:center; clear:both; }

    .clicky { width:19% !important; }

    @media only screen and (min-width:650px) {
    #map svg path:hover{ fill:#378f00 !important; cursor:pointer; }
    #states .active:hover { fill:#333 !important; }
    .myButton:hover { background-color:#378f00 !important; }
    .downloadButton:hover { background-color:#378f00 !important; }
    .myButton2:hover { background-color:#378f00 !important; }
    .myButton3:hover { background-color:#378f00 !important; }
    .myButton_pd:hover { background-color:#378f00 !important; }
    .myButton4:hover { background-color:#378f00 !important; }
    .myButton5:hover { background-color:#378f00 !important; }
    .clicky:hover { cursor:pointer; opacity:.8; }
    }

    .title { font-size:30px; font-weight:900; text-align:center; margin:10px; }
    #states_legend, #poll_legend { text-align:center; }

    @media only screen and (max-width : 300px) { h3 {font-weight:normal !important;} }
</style>

<body>

<div id="wrapper">

<ul class="bxslider">
  <li>
<div class="title">A changing landscape</div>
<a href="javascript:void(0);" id="reset">&#8635;</a>
<div id="map2"></div>

<div id="description">Marijuana's legal status has quickly transformed in various ways across the country.</div>

<div style="clear:both;"><br /><br /></div>

<div id="states_legend">
    <span class="clicky" id="illegal" style='background:#999;padding:10px;color:#fff'>Marijuana illegal</span>
    <span class="clicky" id="oil" style='background:#333;padding:10px;color:#fff'>Medicinal cannabidoil legal</span>
    <span class="clicky" id="medical" style='background:#2b632c;padding:10px;color:#fff'>Medicinal marijuana legal</span>
    <span class="clicky" id="legal" style='background:#61bd1a;padding:10px;color:#fff'>Recreational marijuana legal</span>
    <span id="decriminalized" class="clicky" style='background:#fff;padding:10px;color:#000'>*Decriminalized</span>
</div>
<div style="clear:both;"></div>
<div class="source">Source: <a href="http://norml.org/laws" target="_new">NORML</a></div>
<p class="divider"></p>
<h3>Minnesota passed a medical marijuana law in May 2014, joining about half the country in allowing doctors to prescribe marijuana to their patients, though recreational sales and use remain illegal. Four states and the District of Columbia have additionally legalized marijuana for recreational use.</h3>
  </li>
  <li>
<div class="title">Medical marijuana: What’s allowed, what isn’t?</div>

  <div id="dispense_map"></div>
  <div id="icons">
    <div class="icon"><img src="img/dispensary.png" /></div>
    <div class="factoid">8 marijuana dispensaries serving 87 counties</div>
    <div style="clear:both;"></div>
    <div class="icon"><img src="img/nosmoking.png" /></div>
  	<div class="factoid">No cannabis smoking allowed</div>
    <div style="clear:both;"></div>
  	<div class="icon"><img src="img/vaporizer.png" /></div>
  	<div class="factoid">Liquids, oils and non-leaf vapors allowed</div>
    <div style="clear:both;"></div>
  	<div class="icon"><img src="img/leaf.png" /></div>
  	<div class="factoid">Pill consumption allowed</div>
    <div style="clear:both;"></div>
  	<div class="icon"><img src="img/cross.png" /></div>
    <div class="factoid">Only for the terminally, seriously or chronically ill</div>
  </div>
<div style="clear:both;"></div>
<div class="source">Source: <a href="http://www.startribune.com/lifestyle/health/285779401.html?page=1&c=y" target="_new">Star Tribune</a>, <a href="https://www.revisor.mn.gov/laws/?id=311&year=2014&" target="new_">Minnesota Office of the Revisor of Statutes</a></div>
<p class="divider"></p>
<h3>Minnesota’s eight planned medical cannabis dispensaries are scheduled to begin opening by July 1, 2015. The state has one of the nation’s strictest medical marijuana programs, allowing only seriously ill patients to ingest concentrated marijuana in edible or vapor form, but prohibits smoking.</h3>
  </li>
  <li>
  <div class="title">Lingering opposition to full legalization</div>
  <div id="label_us">National - November 2014</div><div id="label_mn">Minnesota - February 2014</div>
<div id="pie_us"><svg></svg></div><div id="pie_mn"><svg></svg></div>
<div style="clear:both;"></div>
<div id="poll_legend">
    <span style='background:#999;padding:10px;color:#fff'>Not Sure</span>
    <span style='background:#2b632c;padding:10px;color:#fff'>No, don't legalize it</span>
    <span style='background:#61bd1a;padding:10px;color:#fff'>Yes, legalize it</span>
</div>
<div style="clear:both;"></div>
<div id="us_num"><h1>51%</h1><div class="stance">SUPPORT</div></div><div id="mn_num"><h1>30%</h1><div class="stance">SUPPORT</div></div>
<div class="source">Source: <a href="http://www.gallup.com/poll/179195/majority-continues-support-pot-legalization.aspx" target="_new">Gallup</a>, <a href="http://www.startribune.com/politics/245844481.html" target="_new">Star Tribune Minnesota Poll</a></div>
<p class="divider"></p>
<h3>In nationwide surveys, a majority of those polled support the legalization of marijuana for recreational use. In a poll of Minnesotans conducted by the Star Tribune in February 2014, most said they were opposed to legalizing recreational pot.</h3>
  </li>
  <li>
  <div class="title">Prosecutions and convictions on the rise</div>
<button id="caseyear" class="myButton3" onclick="redrawChart2(caseYearData);">Total Statewide Cases Filed</button>
<button id="conyear" class="myButton3" onclick="redrawChart2(conYearData);">Total Statewide Convictions</button>

<div id="chart2"><svg></svg></div>
<div class="source">Source: Supreme Court of Minnesota</div>
<p class="divider"></p>
<h3>Despite changing attitudes and legal status, authorities across Minnesota filed 33,666 cases including felony or misdemeanor marijuana charges between 2010 and 2013. The number of case filings and convictions rose each year during that period.  </h3>

  </li>
  <li>
  <div class="title">Marijuana enforcement by county</div>

  <div id="map_buttons">
<button id="others2" onclick="redrawMap('total');" class="myButton2">Total</button>
<button id="white2" onclick="redrawMap('white');" class="myButton2">White</button>
<button id="black2" onclick="redrawMap('black');" class="myButton2">Black</button>
<button id="native2" onclick="redrawMap('indian');" class="myButton2">Native</button>
<button id="hispanic2" onclick="redrawMap('hispanic');" class="myButton2">Hispanic</button>
<button id="asian2" onclick="redrawMap('asian');" class="myButton2" >Asian</button>
<button id="pacific2" onclick="redrawMap('pacific');" class="myButton2">Pacific</button>
  </div>

<div id="map"><svg width="600" height="500" viewBox="0 0 600 500" preserveAspectRatio="xMidYMid"></svg></div>

<div id="sidebox">
<p style="clear:both;"></p>
<div id="color_legend">
<div class='legend' id="aidQ">
  <nav class='legend clearfix'>
    <span style='background:#fff;'>Less</span>
    <span style='background:#e9f6e6;'></span>
    <span style='background:#c7e9c0;'></span>
    <span style='background:#74c476;'></span>
    <span style='background:#006d2c'></span>
    <span style='background:#fff;'>More</span>
  </nav>
</div>
</div>

<p style="clear:both;"></p>
<p style="clear:both;"></p>

<div id="infobox"></div>

<p style="clear:both;"></p>

<a href="javascript:void(0);" id="zoom">Reset View</a>

</div>
<p style="clear:both;"></p>
<div class="source">Source: Supreme Court of Minnesota, <a href="http://mn.gov/admin/demography/data-by-topic/population-data/our-estimates/" target="_new">Minnesota State Demographic Center</a>, Star Tribune analysis</div>
<p class="divider"></p>
<h3 style="clear:both">The rate of cannabis prosecutions per 1,000 people between 2010 and 2013 was largely consistent in counties across the state. However, some northern counties have higher rates due to drug trafficking activity.</h3>
  </li>

<li>
<div class="title">Increased enforcement among cities</div>
<button id="bigcops" class="myButton_pd" onclick="redrawCopChart(copData);">Cases Filed - Major City Police Departments</button>
<button id="allcops" class="myButton_pd" onclick="redrawCopChart(copTotalData);">Cases Filed - All</button>
<div id="chart_pd"><svg></svg></div>
<div class="source">Source: Supreme Court of Minnesota</div>
<p class="divider"></p>
<h3 style="clear:both">The number of cases filed by police departments in Minnesota’s major cities increased between 2010 and 2013, with some departments steadily filing more cannabis-related cases each year during that period.</h3>
</li>
  <li>
  <div class="title">Petty citations declining in Minneapolis</div>
<button id="mplspetty" class="myButton5" onclick="redrawMPLSChart(mplsData);">MJ Petty Misdemeanors - Minneapolis Arrests</button>
<button id="allpetty" class="myButton5" onclick="redrawMPLSChart(pettyData);">MJ Petty Misdemeanors - MN Convictions</button>
<div id="chart_mpls"><svg></svg></div>
<p></p>
<div class="source">Source: Minnesota Bureau of Criminal Apprehension, <a href="http://norml.org/laws/item/minnesota-penalties-2" target="_new">NORML</a>, <a href="https://www.revisor.mn.gov/statutes/?id=152.01">Minnesota Office of the Revisor of Statutes</a>, Supreme Court of Minnesota, VIBES</div>
<p class="divider"></p>
<h3>Marijuana has long been decriminalized in Minnesota, meaning those carrying less than 42.5 grams may be conditionally discharged for a first offense. Despite rising felony and misdemeanor cases statewide, petty possession arrests in Minneapolis have declined. Black people were arrested for petty possession up to three times more often as whites.</h3>
  </li>
      <li>
  <div class="title">Racial disparities persist</div>
<button id="white" class="myButton4">White</button>
<button id="black" class="myButton4">Black</button>
<button id="hispanic" class="myButton4">Hispanic</button>
<button id="native" class="myButton4">Native</button>
<button id="asian" class="myButton4">Asian</button>
<button id="other" class="myButton4">Other</button>

<p style="clear:both;"></p>

<div id="population">
<div id="box1"></div>
<p style="clear:both;"></p>
<div class="metric">Population</div> 
<span id="pop_pct" class="num">81.9</span><span class="pct">%</span>
</div>

<div id="cases">
<div id="box2"></div>
<p style="clear:both;"></p>
<div class="metric">Cases</div>
<span id="case_pct" class="num">57.3</span><span class="pct">%</span>
</div>

<div style="clear:both"></div>
<div class="source">Source: Supreme Court of Minnesota, <a href="http://quickfacts.census.gov/qfd/states/27000.html" target="new_">U.S. Census Bureau</a>, Star Tribune analysis</div>
<p class="divider"></p>
<h3>Blacks and Native Americans represent disproportionate percentages of cannabis cases filed in Minnesota relative to their overall percentage of the population, while whites are under-represented.</h3>

  </li>
  <li>
  <div class="title">A slower march toward acceptance in Midwest</div>

  Do you think the use of marijuana should be made legal, or not?
<div id="chart_us"><svg></svg></div>

  Regional support for legalizing marijuana (% Yes, should be legal)
<div id="chart_mn"><svg></svg></div>
<div class="source">Source: <a href="http://www.gallup.com/poll/179195/majority-continues-support-pot-legalization.aspx" target="_new">Gallup</a></div>
<p class="divider"></p>
<h3>While attitudes toward legalizing marijuana have shifted quickly and dramatically nationwide, poll data shows Midwestern opinions have been less consistent than other regions. But strong support in the East and West may portend increased support for legal medical and recreational marijuana further into the interior of the country.</h3>
  </li>
  <li>
<div style="clear:both"></div>
<div id="nerdbox">
  <h3>Data Sources</h3>
  
  <div class="source_links">
  <p class='source_row'><div class="source_link"><a href="http://www.gallup.com/poll/179195/majority-continues-support-pot-legalization.aspx" target="_new">Gallup - Majority Continues to Support Pot Legalization in U.S.</a></div>  <div class="download"></div></p>
  <p class='source_row'><div class="source_link"><a href="http://mn.gov/admin/demography/data-by-topic/population-data/our-estimates/" target="_new">Minnesota State Demographic Center - Population Data > Our Estimates</a></div>  <div class="download"></div></p>
   <p class='source_row'><div class="source_link">Minnesota Office of the Revisor of Statutes - <a href="https://www.revisor.mn.gov/statutes/?id=152.01">152.01 DEFINITIONS</a>, <a href="https://www.revisor.mn.gov/laws/?id=311&year=2014&" target="new_">CHAPTER 311--S.F.No. 2470</a></div>  <div class="download"></div></p>
  <p class='source_row'><div class="source_link">NORML - <a href="http://norml.org/legal/medical-marijuana-2" target="_new">Medical Marijuana</a>, <a href="http://norml.org/laws" target="_new">State Laws</a></div>  <div class="download"></div></p>
  <p class='source_row'><div class="source_link"><a href="http://www.startribune.com/politics/245844481.html" target="_new">Star Tribune - Minnesota Poll results: Legalizing marijuana</a></div>  <div class="download"></div></p>
  <p class='source_row'><div class="source_link"><a href="http://quickfacts.census.gov/qfd/states/27000.html" target="new_">U.S. Census Bureau - State & County QuickFacts: Minnesota</a></div>  <div class="download"></div></p>

  </div>

<div style="clear:both"></div>

<div class="download_links">
  <p class='source_row'><div class="source_link">Supreme Court of Minnesota - Marijuana-related cases filed 2010-2013</div> <div class="download"><a href="data/scom.xlsx" target="_new"><button class="downloadButton">&#9660; Download Data</button></a></div></p>
  <p class='source_row'><div class="source_link">Supreme Court of Minnesota - Conviction Depositions, Statute 152.027, 2007-2014</div>  <div class="download"><a href="data/pettys.xlsx" target="_new"><button class="downloadButton">&#9660; Download Data</button></a></div></p>
  <p class='source_row'><div class="source_link">Minneapolis Police Department - Low-level arrests 2012-2014</div>  <div class="download"><a href="data/mpd.xlsx" target="_new"><button class="downloadButton">&#9660; Download Data</button></a></div></p>
  <p class='source_row'><div class="source_link">Minnesota Bureau of Apprehension - Uniform Crime Reports 2009-2014</div>  <div class="download"><a href="data/mpls_ucr.zip" target="_new"><button class="downloadButton">&#9660; Download Data</button></a></div></p>
</div>
</div>

<div id="credits">
    <h3>Credits</h3>

   <div class="credit_block">
  <h5>Data Analysis and Visualization</h5>
  <p>Jeff Hargarten</p>
  <p><a class="article-author-hcard__email" target="_blank" href="mailto:Jeff.Hargarten@startribune.com?subject=Marijuana in Minnesota" data-linkname="Jeff.Hargarten@startribune.com" data-linktype="email" data-modulename="Article" data-moduletype="zone1-content" data-position="0-1-author">Jeff.Hargarten@startribune.com</a> <a class="article-author-hcard__phone" href="tel:612-673-4642" data-linkname="612-673-4642" data-linktype="phone" data-modulename="Article" data-moduletype="zone1-content" data-position="0-1-author">612-673-4642</a> <a class="article-author-hcard__twitter" href="http://twitter.com/jeffhargarten" target="_blank" data-linkname="jeffhargarten" data-linktype="twitter" data-modulename="Article" data-moduletype="zone1-content" data-position="0-1-author">jeffhargarten</a></p>
  </div>

  <div class="credit_block">
  <h5>Data Analysis</h5>
  <p>MaryJo Webster</p>
  <p><a class="article-author-hcard__email" target="_blank" href="mailto:MaryJo.Webster@startribune.com?subject=Marijuana in Minnesota" data-linkname="MaryJo.Webster@startribune.com" data-linktype="email" data-modulename="Article" data-moduletype="zone1-content" data-position="0-1-author">MaryJo.Webster@startribune.com</a> <a class="article-author-hcard__phone" href="tel:612-673-1789" data-linkname="612-673-1789" data-linktype="phone" data-modulename="Article" data-moduletype="zone1-content" data-position="0-1-author">612-673-1789</a> <a class="article-author-hcard__twitter" href="http://twitter.com/maryjowebster" target="_blank" data-linkname="maryjowebster" data-linktype="twitter" data-modulename="Article" data-moduletype="zone1-content" data-position="0-1-author">maryjowebster</a></p>
  </div>

  <div class="credit_block">
  <h5>Presentation Direction</h5>
  <p>Matt DeLong</p>
  <p><a class="article-author-hcard__email" target="_blank" href="mailto:Matt.DeLong@startribune.com?subject=Marijuana in Minnesota" data-linkname="Matt.DeLong@startribune.com" data-linktype="email" data-modulename="Article" data-moduletype="zone1-content" data-position="0-1-author">Matt.DeLong@startribune.com</a> <a class="article-author-hcard__phone" href="tel:612-673-4854" data-linkname="612-673-4854" data-linktype="phone" data-modulename="Article" data-moduletype="zone1-content" data-position="0-1-author">612-673-4854</a> <a class="article-author-hcard__twitter" href="http://twitter.com/mattdelong" target="_blank" data-linkname="mattdelong" data-linktype="twitter" data-modulename="Article" data-moduletype="zone1-content" data-position="0-1-author">mattdelong</a></p>
  </div>

 <div class="credit_block">
  <h5>Data Requests and Collection</h5>
  <p><a href="https://twitter.com/CaptainKurtis" target="new_">Kurtis Hanna</a>, <a href="http://sensible.mn" target="new_">Sensible Minnesota</a></p>
  </div>
  </div>
<div class="bottom_fix"></div>
  </li>
</ul>


</div>
</body>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

<script src="js/nvd3-master/lib/d3.v3.js"></script>
<script src="js/nvd3-master/nv.d3.js"></script>
<script src="js/nvd3-master/src/utils.js"></script>
<script src="js/nvd3-master/src/tooltip.js"></script>
<script src="js/nvd3-master/src/models/legend.js"></script>
<script src="js/nvd3-master/src/models/axis.js"></script>
<script src="js/nvd3-master/examples/stream_layers.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
<script src="js/jquery.bxslider.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/svg.js/1.0.1/svg.min.js"></script>
<script src='https://api.tiles.mapbox.com/mapbox.js/v2.1.8/mapbox.js'></script>
<script type="text/javascript" src="http://prod-www.startribune.com/static/vendor/modernizr/modernizr.js?d=1404405207"></script>

<script>
var aspect = 600 / 500, chart = $("#map svg");
$(window).on("resize", function() {   
  var targetWidth = chart.parent().width();   
  chart.attr("width", targetWidth);   
  chart.attr("height", targetWidth / aspect);
});
</script>

<script>
$(window).load(function(){
   
        });

$( document ).ready(function() {
  $('.bxslider').bxSlider();
  $("#convictions").css("background-color","#333");
  $("#caseyear").css("background-color","#333");
  $("#others2").css("background-color","#333");
  $("#bigcops").css("background-color","#333");
  $("#mplspetty").css("background-color","#333");
$( ".myButton2" ).click(function() {
  $(".myButton2").css("background-color","#61bd1a");
  $(this).css("background-color","#333");
  //clicked2();
  });  
$( ".myButton" ).click(function() {
  $(".myButton").css("background-color","#61bd1a");
  $(this).css("background-color","#333");
  });  
$( ".myButton3" ).click(function() {
  $(".myButton3").css("background-color","#61bd1a");
  $(this).css("background-color","#333");
  }); 
$( ".myButton_pd" ).click(function() {
  $(".myButton_pd").css("background-color","#61bd1a");
  $(this).css("background-color","#333");
  }); 
$( ".myButton5" ).click(function() {
  $(".myButton5").css("background-color","#61bd1a");
  $(this).css("background-color","#333");
  });
});
</script>

<script>

L.mapbox.accessToken = 'pk.eyJ1Ijoic2hhZG93ZmxhcmUiLCJhIjoiS3pwY1JTMCJ9.pTSXx_LFgR3XBpCNNxWPKA';

var map = L.mapbox.map('dispense_map', 'examples.map-20v6611k', { maxZoom: 8, minZoom: 6})
		.setView([46.331758,-93.944092], 6);


if (map.tap) map.tap.disable();



		L.mapbox.featureLayer({
    // this feature is in the GeoJSON format: see geojson.org
    // for the full specification
    type: 'Feature',
    geometry: {
        type: 'Point',
        // coordinates here are in longitude, latitude order because
        // x, y is the standard for GeoJSON and many formats
        coordinates: [
          -93.2650110,
          44.9777530
        ]
    },
    properties: {
        title: 'Minneapolis',
        description: 'Planned Medical Marijuana Dispensary',
        // one can customize markers by adding simplestyle properties
        // https://www.mapbox.com/guides/an-open-platform/#simplestyle
        'marker-size': 'small',
        'marker-color': '#61bd1a',
        'marker-symbol': 'circle'
    }
}).addTo(map);

				L.mapbox.featureLayer({
    // this feature is in the GeoJSON format: see geojson.org
    // for the full specification
    type: 'Feature',
    geometry: {
        type: 'Point',
        // coordinates here are in longitude, latitude order because
        // x, y is the standard for GeoJSON and many formats
        coordinates: [
          -93.0899580,
          44.9537030
        ]
    },
    properties: {
        title: 'St. Paul',
        description: 'Planned Medical Marijuana Dispensary',
        // one can customize markers by adding simplestyle properties
        // https://www.mapbox.com/guides/an-open-platform/#simplestyle
        'marker-size': 'small',
        'marker-color': '#61bd1a',
        'marker-symbol': 'circle'
    }
}).addTo(map);

		L.mapbox.featureLayer({
    // this feature is in the GeoJSON format: see geojson.org
    // for the full specification
    type: 'Feature',
    geometry: {
        type: 'Point',
        // coordinates here are in longitude, latitude order because
        // x, y is the standard for GeoJSON and many formats
        coordinates: [
          -93.1668860,
          44.8041320
        ]
    },
    properties: {
        title: 'Eagan',
        description: 'Planned Medical Marijuana Dispensary',
        // one can customize markers by adding simplestyle properties
        // https://www.mapbox.com/guides/an-open-platform/#simplestyle
        'marker-size': 'small',
        'marker-color': '#61bd1a',
        'marker-symbol': 'circle'
    }
}).addTo(map);

L.mapbox.featureLayer({
    // this feature is in the GeoJSON format: see geojson.org
    // for the full specification
    type: 'Feature',
    geometry: {
        type: 'Point',
        // coordinates here are in longitude, latitude order because
        // x, y is the standard for GeoJSON and many formats
        coordinates: [
          -93.4707860,
          44.8546860
        ]
    },
    properties: {
        title: 'Eden Prairie',
        description: 'Planned Medical Marijuana Dispensary',
        // one can customize markers by adding simplestyle properties
        // https://www.mapbox.com/guides/an-open-platform/#simplestyle
        'marker-size': 'small',
        'marker-color': '#61bd1a',
        'marker-symbol': 'circle'
    }
}).addTo(map);

		L.mapbox.featureLayer({
    // this feature is in the GeoJSON format: see geojson.org
    // for the full specification
    type: 'Feature',
    geometry: {
        type: 'Point',
        // coordinates here are in longitude, latitude order because
        // x, y is the standard for GeoJSON and many formats
        coordinates: [
          -94.1632400,
          45.5579450
        ]
    },
    properties: {
        title: 'St. Cloud',
        description: 'Planned Medical Marijuana Dispensary',
        // one can customize markers by adding simplestyle properties
        // https://www.mapbox.com/guides/an-open-platform/#simplestyle
        'marker-size': 'small',
        'marker-color': '#61bd1a',
        'marker-symbol': 'circle'
    }
}).addTo(map);

		L.mapbox.featureLayer({
    // this feature is in the GeoJSON format: see geojson.org
    // for the full specification
    type: 'Feature',
    geometry: {
        type: 'Point',
        // coordinates here are in longitude, latitude order because
        // x, y is the standard for GeoJSON and many formats
        coordinates: [
          -92.9376890,
          47.4271550
        ]
    },
    properties: {
        title: 'Hibbing',
        description: 'Planned Medical Marijuana Dispensary',
        // one can customize markers by adding simplestyle properties
        // https://www.mapbox.com/guides/an-open-platform/#simplestyle
        'marker-size': 'small',
        'marker-color': '#61bd1a',
        'marker-symbol': 'circle'
    }
}).addTo(map);


		L.mapbox.featureLayer({
    // this feature is in the GeoJSON format: see geojson.org
    // for the full specification
    type: 'Feature',
    geometry: {
        type: 'Point',
        // coordinates here are in longitude, latitude order because
        // x, y is the standard for GeoJSON and many formats
        coordinates: [
          -96.7678040,
          46.8737650
        ]
    },
    properties: {
        title: 'Moorhead',
        description: 'Planned Medical Marijuana Dispensary',
        // one can customize markers by adding simplestyle properties
        // https://www.mapbox.com/guides/an-open-platform/#simplestyle
        'marker-size': 'small',
        'marker-color': '#61bd1a',
        'marker-symbol': 'circle'
    }
}).addTo(map);

		L.mapbox.featureLayer({
    // this feature is in the GeoJSON format: see geojson.org
    // for the full specification
    type: 'Feature',
    geometry: {
        type: 'Point',
        // coordinates here are in longitude, latitude order because
        // x, y is the standard for GeoJSON and many formats
        coordinates: [
          -92.4629500,
          44.0234000
        ]
    },
    properties: {
        title: 'Rochester',
        description: 'Planned Medical Marijuana Dispensary',
        // one can customize markers by adding simplestyle properties
        // https://www.mapbox.com/guides/an-open-platform/#simplestyle
        'marker-size': 'small',
        'marker-color': '#61bd1a',
        'marker-symbol': 'circle'
    }
}).addTo(map);
</script>

<script>

var chart2;
nv.addGraph(function() {
    chart2 = nv.models.multiBarChart()
        .x(function(d) { return d.label })
        .y(function(d) { return d.value })
      .transitionDuration(350)
      .reduceXTicks(false)   //If 'false', every single x-axis tick label will be rendered.
      .rotateLabels(0)      //Angle to rotate x-axis labels.
      .showControls(false)   //Allow user to switch between 'Grouped' and 'Stacked' mode.
      .stacked(true)
      .groupSpacing(0.1)    //Distance between each group of bars.
      .margin({top: 30, right: 100, bottom: 30, left: 50})
      .tooltip(function(key, x, y, e, graph) { return '<h3>' + key + '</h3>' +'<p>' +  y + ' in ' + x + '</p>';});

    chart2.yAxis
        .tickFormat(d3.format(','));

    d3.select('#chart2 svg')
        .datum(caseYearData)
        .call(chart2);

    nv.utils.windowResize(chart2.update);

    return chart2;
});

var chart3;
nv.addGraph(function() {
    chart3 = nv.models.multiBarChart()
        .x(function(d) { return d.label })
        .y(function(d) { return d.value })
      .transitionDuration(350)
      .reduceXTicks(false)   //If 'false', every single x-axis tick label will be rendered.
      .rotateLabels(0)      //Angle to rotate x-axis labels.
      .showControls(true)   //Allow user to switch between 'Grouped' and 'Stacked' mode.
      .stacked(true)
      .groupSpacing(0.1)    //Distance between each group of bars.
      .tooltip(function(key, x, y, e, graph) {return '<h3>' + x + '</h3>' + '<p>' +  y + ' ' + key + '</p>';});

    chart3.yAxis
        .tickFormat(d3.format(','));

    d3.select('#chart_mpls svg')
        .datum(mplsData)
        .call(chart3);

    nv.utils.windowResize(chart3.update);

    return chart3;
});

var chart4;
nv.addGraph(function() {
    chart4 = nv.models.multiBarChart()
        .x(function(d) { return d.label })
        .y(function(d) { return d.value })
      .transitionDuration(350)
      .reduceXTicks(false)   //If 'false', every single x-axis tick label will be rendered.
      .rotateLabels(0)      //Angle to rotate x-axis labels.
      .showControls(true)   //Allow user to switch between 'Grouped' and 'Stacked' mode.
      .stacked(false)
      .groupSpacing(0.1)    //Distance between each group of bars.
      .tooltip(function(key, x, y, e, graph) {return '<h3>' + x + '</h3>' + '<p>' +  y + ' ' + key + 's arrested</p>';});

    chart4.yAxis
        .tickFormat(d3.format(','));

    d3.select('#chart_aclu svg')
        .datum(acluData)
        .call(chart4);

    nv.utils.windowResize(chart4.update);

    return chart4;
});

var chart5;
nv.addGraph(function() {
  chart5 = nv.models.pieChart()
      .x(function(d) { return d.label })
      .y(function(d) { return d.value })
      .showLegend(false)
      .showLabels(false)     //Display pie labels
      .labelThreshold(.05)  //Configure the minimum slice size for labels to show up
      .labelType("percent") //Configure what type of data to show in the label. Can be "key", "value" or "percent"
      .donut(true)          //Turn on Donut mode. Makes pie chart look tasty!
      .color(['#61bd1a', '#2b632c', '#999', '#2B2B2B', '#121212'])
      .margin({top: 5, right: 5, bottom: 0, left: 5})
      .tooltipContent(function(key, y, e, graph) { return  '<strong>' + key + ': ' + y + '</strong>' ; })
      .donutRatio(0.5)     //Configure how big you want the donut hole size to be.
      ;

    chart5.valueFormat(d3.format('%'));

    d3.select("#pie_us svg")
        .datum(usPoll)
        .transition().duration(350)
        .call(chart5);

  return chart5;
});

var chart6;
nv.addGraph(function() {
  chart6 = nv.models.pieChart()
      .x(function(d) { return d.label })
      .y(function(d) { return d.value })
      .showLegend(false)
      .showLabels(false)     //Display pie labels
      .labelThreshold(.05)  //Configure the minimum slice size for labels to show up
      .labelType("percent") //Configure what type of data to show in the label. Can be "key", "value" or "percent"
      .donut(true)          //Turn on Donut mode. Makes pie chart look tasty!
      .color(['#61bd1a', '#2b632c', '#999', '#2B2B2B', '#121212'])
      .margin({top: 5, right: 5, bottom: 0, left: 5})
      .tooltipContent(function(key, y, e, graph) { return  '<strong>' + key + ': ' + y + '</strong>' ; })
      .donutRatio(0.5)     //Configure how big you want the donut hole size to be.
      ;

    chart6.valueFormat(d3.format('%'));

    d3.select("#pie_mn svg")
        .datum(mnPoll)
        .transition().duration(350)
        .call(chart6);

  return chart6;
});


var chart7;
nv.addGraph(function() {  
   chart7 = nv.models.cumulativeLineChart()
            .x(function(d) {return d[0]})
            .y(function(d) {return d[1]})
            .color(['#61bd1a', '#2b632c', '#BCBCBC', '#2B2B2B', '#121212'])
            .showControls(false)
            .margin({top: 30, right: 30, bottom: 50, left: 160})
            .useInteractiveGuideline(true);

            chart7.xAxis.showMaxMin(false)
            .tickValues([1041400800000,1104559200000,1262325600000,1293861600000,1325397600000,1357020000000,1388556000000])
            .tickFormat(function(d) {
                      return d3.time.format('%Y')(new Date(d))
             });

            chart7.yAxis.tickFormat(d3.format(",%"));

            // chart7.forceY([.20, .70]);

chart7.yAxis
  .scale()
    .domain([.20, .70]);

  d3.select('#chart_us svg')
    .datum(usTime)
    .transition().duration(500)
    .call(chart7)
    ;


  nv.utils.windowResize(chart7.update);

  return chart7;
});

var chart8;
nv.addGraph(function() {  
   chart8 = nv.models.cumulativeLineChart()
             .x(function(d) {return d[0] })
            .y(function(d) { return d[1] }) 
            .color(['#BCBCBC', '#555', '#121212','#61bd1a', '#2b632c'])
            .showControls(false)
            .margin({top: 30, right: 30, bottom: 50, left: 160})
            .useInteractiveGuideline(true);

            chart8.xAxis.showMaxMin(false)
            .tickValues([1262325600000,1293861600000,1325397600000,1357020000000,1388556000000])
            .tickFormat(function(d) {
                      return d3.time.format('%Y')(new Date(d))
             });

            chart8.yAxis.tickFormat(d3.format(",%"));

            // chart8.forceY([.20, .70]);

chart8.yAxis
  .scale()
    .domain([.20, .70]);

  d3.select('#chart_mn svg')
    .datum(mnTime)
    .transition().duration(500)
    .call(chart8)
    ;

  nv.utils.windowResize(chart8.update);

  return chart8;
});

var chart9;
nv.addGraph(function() {
    chart9 = nv.models.multiBarChart()
        .x(function(d) { return d.label })
        .y(function(d) { return d.value })
      .transitionDuration(350)
      .reduceXTicks(false)   //If 'false', every single x-axis tick label will be rendered.
      .rotateLabels(0)      //Angle to rotate x-axis labels.
      .showControls(true)   //Allow user to switch between 'Grouped' and 'Stacked' mode.
      .stacked(true)
      .color(['#e6e6e6', '#d5d5d5', '#c4c4c4', '#b4b4b4', '#a3a3a3', '#929292', '#818181', '#707070', '#5f5f5f','#4e4e4e', '#3d3d3d', '#2c2c2c', '#1b1b1b', '#0a0a0a', '#000'])
      .groupSpacing(0.1)    //Distance between each group of bars.
      .tooltip(function(key, x, y, e, graph) {return '<h3>' + x + '</h3>' + '<p>' +  y + ' ' + key + ' cases</p>';});

    chart9.yAxis
        .tickFormat(d3.format(','));

    d3.select('#chart_pd svg')
        .datum(copData)
        .call(chart9);

    nv.utils.windowResize(chart9.update);

    return chart9;
});

var usTime = [
  {
    "key": "Yes, legal",
    "values": [
  [1041400800000,0],
  [1041400800000,.34],
  [1104559200000,.36],
  [1230789600000,.44],
  [1262325600000,.46],
  [1293861600000,.50],
  [1325397600000,.48],
  [1357020000000,.58],
  [1388556000000,.51]
]
  },
    {
    "key": "No, illegal",
    "values": [
  [1041400800000,0],
  [1041400800000,.64],
  [1104559200000,.60],
  [1230789600000,.54],
  [1262325600000,.50],
  [1293861600000,.46],
  [1325397600000,.50],
  [1357020000000,.39],
  [1388556000000,.47]
]
  }
]

var mnTime = [
  {
    "key": "East",
    "values": [
  [1262325600000,0],
  [1262325600000,.47],
  [1293861600000,.51],
  [1325397600000,.55],
  [1357020000000,.60],
  [1388556000000,.57]
]
  },
    {
    "key": "West",
    "values": [
  [1262325600000,0],
  [1262325600000,.58],
  [1293861600000,.55],
  [1325397600000,.52],
  [1357020000000,.63],
  [1388556000000,.57]
]
  },
    {
    "key": "South",
    "values": [
  [1262325600000,0],
  [1262325600000,.40],
  [1293861600000,.44],
  [1325397600000,.45],
  [1357020000000,.52],
  [1388556000000,.47]
]
  },
    {
    "key": "Midwest",
    "values": [
  [1262325600000,0],
  [1262325600000,.41],
  [1293861600000,.54],
  [1325397600000,.44],
  [1357020000000,.58],
  [1388556000000,.45]
]
  }
]

var usPoll = [
      { 
        "label": "Yes, legalize it",
        "value" : .51
      } , 
      { 
        "label": "No, don't legalize it",
        "value" : .47
      } , 
      { 
        "label": "Not sure",
        "value" : .02
      } 
    ]

var mnPoll = [
      { 
        "label": "Yes, legalize it",
        "value" : .30
      } , 
      { 
        "label": "No, don't legalize it",
        "value" : .63
      } , 
      { 
        "label": "Not sure",
        "value" : .07
      } 
    ]

var acluData = [
   {
    "key": "White",
    "color": "#BCBCBC",
    "values": [ 
      { 
        "label" : "2012" ,
        "value" : 411
      } ,       
      { 
        "label" : "2013" ,
        "value" : 460
      }  , 
      { 
        "label" : "2014" ,
        "value" : 229
      }
    ]
  },
  {
    "key": "Black",
    "color": "#808080",
    "values": [
      { 
        "label" : "2012" ,
        "value" : 1232
      } ,       
      { 
        "label" : "2013" ,
        "value" : 1142
      }  , 
      { 
        "label" : "2014" ,
        "value" : 805
      }
    ]
  },
  {
    "key": "Asian",
    "color": "#515151",
    "values": [
      { 
        "label" : "2012" ,
        "value" : 18
      } ,       
      { 
        "label" : "2013" ,
        "value" : 9
      }  , 
      { 
        "label" : "2014" ,
        "value" : 12
      }
    ]
  },
    {
    "key": "Native",
    "color": "#2B2B2B",
    "values": [
      { 
        "label" : "2012" ,
        "value" : 45
      } ,       
      { 
        "label" : "2013" ,
        "value" : 57
      }  , 
      { 
        "label" : "2014" ,
        "value" : 19
      }
    ]
  },
    {
    "key": "Other",
    "color": "#121212",
    "values": [
      { 
        "label" : "2012" ,
        "value" : 112
      } ,       
      { 
        "label" : "2013" ,
        "value" : 147
      }  , 
      { 
        "label" : "2014" ,
        "value" : 92
      }
    ]
  }
]

var mplsData = [
   {
    "key": "White",
    "color": "#BCBCBC",
    "values": [
      { 
        "label" : "2009" ,
        "value" : 231
      } , 
      { 
        "label" : "2010" ,
        "value" : 207
      } , 
      { 
        "label" : "2011" ,
        "value" : 216
      }  , 
      { 
        "label" : "2012" ,
        "value" : 248
      } ,       
      { 
        "label" : "2013" ,
        "value" : 231
      }  , 
      { 
        "label" : "2014" ,
        "value" : 196
      }
    ]
  },
  {
    "key": "Black",
    "color": "#808080",
    "values": [
      { 
        "label" : "2009" ,
        "value" : 746
      } , 
      { 
        "label" : "2010" ,
        "value" : 737
      } , 
      { 
        "label" : "2011" ,
        "value" : 526
      }  , 
      { 
        "label" : "2012" ,
        "value" : 569
      } ,       
      { 
        "label" : "2013" ,
        "value" : 510
      }  , 
      { 
        "label" : "2014" ,
        "value" : 497
      }
    ]
  },
   {
    "key": "Other",
    "color": "#515151",
    "values": [
      { 
        "label" : "2009" ,
        "value" : 53
      } , 
      { 
        "label" : "2010" ,
        "value" : 33
      } , 
      { 
        "label" : "2011" ,
        "value" : 24
      }  , 
      { 
        "label" : "2012" ,
        "value" : 20
      } ,       
      { 
        "label" : "2013" ,
        "value" : 23
      }  , 
      { 
        "label" : "2014" ,
        "value" : 18
      }
    ]
  }
]

var caseData = [
  {
    "key": "Cases",
    "color": "#BCBCBC",
    "values": [
      { 
        "label" : "White" ,
        "value" : .572
      } , 
      { 
        "label" : "Black" ,
        "value" : .168
      } , 
      { 
        "label" : "Native" ,
        "value" : .0551
      }  , 
      { 
        "label" : "Hispanic" ,
        "value" : .0524
      } ,       
      { 
        "label" : "Asian" ,
        "value" : .020
      }  , 
      { 
        "label" : "Pacific" ,
        "value" : .0018
      }
    ]
  },
  {
    "key": "Population",
    "color": "#808080",
    "values": [
      { 
        "label" : "White" ,
        "value" : .819
      } , 
      { 
        "label" : "Black" ,
        "value" : .057
      } , 
      { 
        "label" : "Native" ,
        "value" : .013
      }  , 
      { 
        "label" : "Hispanic" ,
        "value" : .05
      } ,       
      { 
        "label" : "Asian" ,
        "value" : .045
      }  , 
      { 
        "label" : "Pacific" ,
        "value" : .001
      }
    ]
  }
]

var convictionData = [
    {
    "key": "Convictions",
    "color": "#BCBCBC",
    "values": [
      { 
        "label" : "White" ,
        "value" : .561
      } , 
      { 
        "label" : "Black" ,
        "value" : .176
      } , 
      { 
        "label" : "Native" ,
        "value" : .056
      }  , 
      { 
        "label" : "Hispanic" ,
        "value" : .055
      } ,       
      { 
        "label" : "Asian" ,
        "value" : .021
      }  , 
      { 
        "label" : "Pacific" ,
        "value" : .0019
      }
    ]
  },
{
    "key": "Cases",
    "color": "#808080",
    "values": [
      { 
        "label" : "White" ,
        "value" : .576
      } , 
      { 
        "label" : "Black" ,
        "value" : .169
      } , 
      { 
        "label" : "Native" ,
        "value" : .0551
      }  , 
      { 
        "label" : "Hispanic" ,
        "value" : .0524
      } ,       
      { 
        "label" : "Asian" ,
        "value" : .020
      }  , 
      { 
        "label" : "Pacific" ,
        "value" : .0018
      }
    ]
  },
  {
    "key": "Population",
    "color": "#515151",
    "values": [
      { 
        "label" : "White" ,
        "value" : .819
      } , 
      { 
        "label" : "Black" ,
        "value" : .057
      } , 
      { 
        "label" : "Native" ,
        "value" : .013
      }  , 
      { 
        "label" : "Hispanic" ,
        "value" : .05
      } ,       
      { 
        "label" : "Asian" ,
        "value" : .045
      }  , 
      { 
        "label" : "Pacific" ,
        "value" : .001
      }
    ]
  }
]

var outcomeData = [
  {
    "key": "Felonies",
    "color": "#BCBCBC",
    "values": [
      { 
        "label" : "White" ,
        "value" : .841
      } , 
      { 
        "label" : "Black" ,
        "value" : .8698
      } , 
      { 
        "label" : "Native" ,
        "value" : .8897
      }  , 
      { 
        "label" : "Hispanic" ,
        "value" : .8841
      } ,       
      { 
        "label" : "Asian" ,
        "value" : .9118
      }  , 
      { 
        "label" : "Pacific" ,
        "value" : .860
      }
    ]
  },
  {
    "key": "Misdemeanors",
    "color": "#808080",
    "values": [
      { 
        "label" : "White" ,
        "value" : .1589
      } , 
      { 
        "label" : "Black" ,
        "value" : .1301
      } , 
      { 
        "label" : "Native" ,
        "value" : .110
      }  , 
      { 
        "label" : "Hispanic" ,
        "value" : .1158
      } ,       
      { 
        "label" : "Asian" ,
        "value" : .0881
      }  , 
      { 
        "label" : "Pacific" ,
        "value" : .1395
      }
    ]
  }
]

var pettyData = [
    {
    "key": "Petty Misdemeanors",
    "color": "#BCBCBC",
    "values": [
      { 
        "label" : "2009" ,
        "value" : 4158
      },
      { 
        "label" : "2010" ,
        "value" : 4401
      },
      { 
        "label" : "2011" ,
        "value" : 4483
      },
      { 
        "label" : "2012" ,
        "value" : 4916
      },
      { 
        "label" : "2013" ,
        "value" : 4853
      },
      { 
        "label" : "2014" ,
        "value" : 4396
      }
    ]
  }
]

var caseYearData = [
  {
    "key": "Felonies",
    "color": "#BCBCBC",
    "values": [
      { 
        "label" : "2010" ,
        "value" : 6462
      },
      { 
        "label" : "2011" ,
        "value" : 6432
      },
      { 
        "label" : "2012" ,
        "value" : 7334
      },
      { 
        "label" : "2013" ,
        "value" : 8278
      }
    ]
  },
  {
    "key": "Misdemeanors",
    "color": "#808080",
    "values": [
      { 
        "label" : "2010" ,
        "value" : 1019
      },
      { 
        "label" : "2011" ,
        "value" : 1203
      },
      { 
        "label" : "2012" ,
        "value" : 1462
      },
      { 
        "label" : "2013" ,
        "value" : 1442
      }
    ]
   } ,
    {
    "key": "Gross Misdemeanors",
    "color": "#515151",
    "values": [
      { 
        "label" : "2010" ,
        "value" : 7
      },
      { 
        "label" : "2011" ,
        "value" : 13
      },
      { 
        "label" : "2012" ,
        "value" : 4
      },
      { 
        "label" : "2013" ,
        "value" : 10
      }
    ]
   }
]

var conYearData = [
  {
    "key": "Felonies",
    "color": "#BCBCBC",
    "values": [
      { 
        "label" : "2010" ,
        "value" : 2955
      },
      { 
        "label" : "2011" ,
        "value" : 3095
      },
      { 
        "label" : "2012" ,
        "value" : 3216
      },
      { 
        "label" : "2013" ,
        "value" : 3558
      }
    ]
  },
  {
    "key": "Misdemeanors",
    "color": "#808080",
    "values": [
      { 
        "label" : "2010" ,
        "value" : 1226
      },
      { 
        "label" : "2011" ,
        "value" : 1227
      },
      { 
        "label" : "2012" ,
        "value" : 1007
      },
      { 
        "label" : "2013" ,
        "value" : 845
      }
    ]
   } ,
    {
    "key": "Gross Misdemeanors",
    "color": "#515151",
    "values": [
      { 
        "label" : "2010" ,
        "value" : 5
      },
      { 
        "label" : "2011" ,
        "value" : 5
      },
      { 
        "label" : "2012" ,
        "value" : 5
      },
      { 
        "label" : "2013" ,
        "value" : 4
      }
    ]
   },
  {
    "key": "Other",
    "color": "#222",
    "values": [
      { 
        "label" : "2010" ,
        "value" : 8
      },
      { 
        "label" : "2011" ,
        "value" : 7
      },
      { 
        "label" : "2012" ,
        "value" : 2
      },
      { 
        "label" : "2013" ,
        "value" : 2
      }
    ]
  }
]

var copData = [
  {
    "key": "Minneapolis",
    "values": [
      { 
        "label" : "2010" ,
        "value" : 658
      },
      { 
        "label" : "2011" ,
        "value" : 684
      },
      { 
        "label" : "2012" ,
        "value" : 822
      },
      { 
        "label" : "2013" ,
        "value" : 910
      }
    ]
  }, 
  //  {
  //   "key": "Hennepin County",
  //   "values": [
  //     { 
  //       "label" : "2010" ,
  //       "value" : 321
  //     },
  //     { 
  //       "label" : "2011" ,
  //       "value" : 357
  //     },
  //     { 
  //       "label" : "2012" ,
  //       "value" : 437
  //     },
  //     { 
  //       "label" : "2013" ,
  //       "value" : 588
  //     }
  //   ]
  // },
  {
    "key": "St. Paul",
    "values": [
      { 
        "label" : "2010" ,
        "value" : 470
      },
      { 
        "label" : "2011" ,
        "value" : 421
      },
      { 
        "label" : "2012" ,
        "value" : 293
      },
      { 
        "label" : "2013" ,
        "value" : 474
      }
    ]
  },
  //   {
  //   "key": "Ramsey County",
  //   "values": [
  //     { 
  //       "label" : "2010" ,
  //       "value" : 129
  //     },
  //     { 
  //       "label" : "2011" ,
  //       "value" : 159
  //     },
  //     { 
  //       "label" : "2012" ,
  //       "value" : 115
  //     },
  //     { 
  //       "label" : "2013" ,
  //       "value" : 140
  //     }
  //   ]
  // },
  {
    "key": "Rochester",
    "values": [
      { 
        "label" : "2010" ,
        "value" : 139
      },
      { 
        "label" : "2011" ,
        "value" : 129
      },
      { 
        "label" : "2012" ,
        "value" : 164
      },
      { 
        "label" : "2013" ,
        "value" : 187
      }
    ]
  },
  {
    "key": "Duluth",
    "values": [
      { 
        "label" : "2010" ,
        "value" : 133
      },
      { 
        "label" : "2011" ,
        "value" : 126
      },
      { 
        "label" : "2012" ,
        "value" : 245
      },
      { 
        "label" : "2013" ,
        "value" : 337
      }
    ]
  },
  // {
  //   "key": "St. Louis County",
  //   "values": [
  //     { 
  //       "label" : "2010" ,
  //       "value" : 235
  //     },
  //     { 
  //       "label" : "2011" ,
  //       "value" : 288
  //     },
  //     { 
  //       "label" : "2012" ,
  //       "value" : 254
  //     },
  //     { 
  //       "label" : "2013" ,
  //       "value" : 256
  //     }
  //   ]
  // },
  {
    "key": "Bloomington",
    "values": [
      { 
        "label" : "2010" ,
        "value" : 103
      },
      { 
        "label" : "2011" ,
        "value" : 95
      },
      { 
        "label" : "2012" ,
        "value" : 156
      },
      { 
        "label" : "2013" ,
        "value" : 169
      }
    ]
  },
  {
    "key": "Brooklyn Park",
    "values": [
      { 
        "label" : "2010" ,
        "value" : 56
      },
      { 
        "label" : "2011" ,
        "value" : 85
      },
      { 
        "label" : "2012" ,
        "value" : 107
      },
      { 
        "label" : "2013" ,
        "value" : 103
      }
    ]
  },
  {
    "key": "Plymouth",
    "values": [
      { 
        "label" : "2010" ,
        "value" : 42
      },
      { 
        "label" : "2011" ,
        "value" : 31
      },
      { 
        "label" : "2012" ,
        "value" : 43
      },
      { 
        "label" : "2013" ,
        "value" : 34
      }
    ]
  },
  {
    "key": "Saint Cloud",
    "values": [
      { 
        "label" : "2010" ,
        "value" : 191
      },
      { 
        "label" : "2011" ,
        "value" : 211
      },
      { 
        "label" : "2012" ,
        "value" : 213
      },
      { 
        "label" : "2013" ,
        "value" : 254
      }
    ]
  },
  {
    "key": "Mankato",
    "values": [
      { 
        "label" : "2010" ,
        "value" : 93
      },
      { 
        "label" : "2011" ,
        "value" : 110
      },
      { 
        "label" : "2012" ,
        "value" : 106
      },
      { 
        "label" : "2013" ,
        "value" : 198
      }
    ]
  },
  {
    "key": "Coon Rapids",
    "values": [
      { 
        "label" : "2010" ,
        "value" : 54
      },
      { 
        "label" : "2011" ,
        "value" : 64
      },
      { 
        "label" : "2012" ,
        "value" : 76
      },
      { 
        "label" : "2013" ,
        "value" : 119
      }
    ]
  },  
  {
    "key": "Eagan",
    "values": [
      { 
        "label" : "2010" ,
        "value" : 58
      },
      { 
        "label" : "2011" ,
        "value" : 83
      },
      { 
        "label" : "2012" ,
        "value" : 66
      },
      { 
        "label" : "2013" ,
        "value" : 77
      }
    ]
  },  
  {
    "key": "Woodbury",
    "values": [
      { 
        "label" : "2010" ,
        "value" : 39
      },
      { 
        "label" : "2011" ,
        "value" : 48
      },
      { 
        "label" : "2012" ,
        "value" : 64
      },
      { 
        "label" : "2013" ,
        "value" : 49
      }
    ]
  },  
  {
    "key": "Maple Grove",
    "values": [
      { 
        "label" : "2010" ,
        "value" : 21
      },
      { 
        "label" : "2011" ,
        "value" : 32
      },
      { 
        "label" : "2012" ,
        "value" : 17
      },
      { 
        "label" : "2013" ,
        "value" : 31
      }
    ]
  }//,
  // {
  //   "key": "MN State Patrol",
  //   "values": [
  //     { 
  //       "label" : "2010" ,
  //       "value" : 930
  //     },
  //     { 
  //       "label" : "2011" ,
  //       "value" : 1064
  //     },
  //     { 
  //       "label" : "2012" ,
  //       "value" : 1259
  //     },
  //     { 
  //       "label" : "2013" ,
  //       "value" : 1147
  //     }
  //   ]
  // }
]

var copTotalData = [
  {
    "key": "Total",
    "values": [
      { 
        "label" : "2010" ,
        "value" : 7488
      },
      { 
        "label" : "2011" ,
        "value" : 7648
      },
      { 
        "label" : "2012" ,
        "value" : 8800
      },
      { 
        "label" : "2013" ,
        "value" : 9730
      }
    ]
  }
]


function redrawChart(data){
    d3.select('#chart1 svg').datum(data).transition().duration(500).call(chart);
    nv.utils.windowResize(chart.update);
}

function redrawChart2(data){
    d3.select('#chart2 svg').datum(data).transition().duration(500).call(chart2);
    nv.utils.windowResize(chart2.update);
}

function redrawCopChart(data){
    d3.select('#chart_pd svg').datum(data).transition().duration(500).call(chart9);
    nv.utils.windowResize(chart9.update);
}

function redrawMPLSChart(data){
    d3.select('#chart_mpls svg').datum(data).transition().duration(500).call(chart3);
    nv.utils.windowResize(chart9.update);
}
</script>

<script>
var none = "#f7f7f7";
var q1="#e9f6e6";
var q2="#c7e9c0";
var q3="#74c476";
var q4="#006d2c";
var q5="#002911";

function redrawMap(race){

var districtInfo = document.getElementById('infobox');

d3.csv("data/county_race.csv", function(error, popData) {
    popData.forEach(function(d) {
        d.county = d.county;
	d.white = +d.white;
	d.black = +d.black;
	d.asian = +d.asian;
	d.pacific = +d.pacific;
	d.indian = +d.indian;
	d.hispanic = +d.hispanic;
	d.population = +d.population;
    });


d3.csv("data/cannabis_county_data.csv", function(error, csvData2) {
    csvData2.forEach(function(d) {
        d.race = d.race;
	d.county = d.county;
	d.convictions = +d.convictions;
	d.total = +d.total;
    });

d3.csv("data/cannabis_county_cases.csv", function(error, caseData) {
    csvData2.forEach(function(d) {
        d.race = d.race;
	d.county = d.county;
	d.cases = +d.cases;
	d.total = +d.total;
    });

    d3.select('#map svg').selectAll("path")
       .on("mousedown", function(d, i){

districtInfo.innerHTML = "<div class='county_name'>" + d.properties.COUNTYNAME + " </div><div class='prevalence'>0 cannabis-related cases filed</div> ";

      for (var i = 0; i < caseData.length; i++){

      if (race == "total"){
          if ((d.properties.COUNTYNAME == caseData[i].county)){
           for (var k = 0; k < popData.length; k++){
if (popData[k].county == d.properties.COUNTYNAME){
var result = (caseData[i].total / popData[k].population) * 1000;
districtInfo.innerHTML = "<div class='county_name'>" + d.properties.COUNTYNAME + "</div><div class='prevalence'>" + d3.round(result, 1) + " cannabis-related cases filed per 1,000 people</div>";
}
		}
          }
       } else {

        if ((caseData[i].race == race) && (d.properties.COUNTYNAME == caseData[i].county)){
           for (var k = 0; k < popData.length; k++){
             if (popData[k].county == d.properties.COUNTYNAME){
                  if (race == "white"){var race_pop = popData[k].white; var cons = caseData[i].convictions;}
		  else if(race == "black"){var race_pop = popData[k].black; var cons = caseData[i].convictions;}
		  else if(race == "asian"){var race_pop = popData[k].asian; var cons = caseData[i].convictions;}
		  else if(race == "indian"){var race_pop = popData[k].indian; var cons = caseData[i].convictions;}
		  else if(race == "pacific"){var race_pop = popData[k].pacific; var cons = caseData[i].convictions;}
		  else if(race == "hispanic"){var race_pop = popData[k].hispanic; var cons = caseData[i].convictions;}

if (isFinite(caseData[i].convictions)){
var result = (cons / race_pop) * 1000;
districtInfo.innerHTML = "<div class='county_name'>" + d.properties.COUNTYNAME + " County</div><div class='prevalence'>" + d3.round(result, 1) + " cannabis-related cases filed per 1,000 " + race + " people</div>";
}
             }
	   }
	}
      }
}
})
      .style("fill", function(d){
      for (var i = 0; i < caseData.length; i++){
      if (race == "total"){
          if ((d.properties.COUNTYNAME == caseData[i].county)){
           for (var k = 0; k < popData.length; k++){
if (popData[k].county == d.properties.COUNTYNAME){
//console.log((caseData[i].total / popData[k].population) * 1000);
            if (((caseData[i].total / popData[k].population) * 1000) > 20 ) { return q5; }
            if (((caseData[i].total / popData[k].population) * 1000) > 15 ) { return q4; }
            if (((caseData[i].total / popData[k].population) * 1000) > 10 ) { return q3; }
            if (((caseData[i].total / popData[k].population) * 1000) > 5 ) { return q2; }
            if (((caseData[i].total / popData[k].population) * 1000) > 0 ) { return q1; }
}
		}
          }
       } else {
          if ((caseData[i].race == race) && (d.properties.COUNTYNAME == caseData[i].county)){
           for (var k = 0; k < popData.length; k++){
            if (popData[k].county == d.properties.COUNTYNAME){
                  if (race == "white"){var race_pop = popData[k].white; }
		  else if(race == "black"){var race_pop = popData[k].black; }
		  else if(race == "asian"){var race_pop = popData[k].asian; }
		  else if(race == "indian"){var race_pop = popData[k].indian; }
		  else if(race == "pacific"){var race_pop = popData[k].pacific; }
		  else if(race == "hispanic"){var race_pop = popData[k].hispanic; }

              if (((caseData[i].convictions / race_pop) * 1000) > 75) { return q5; }
              if (((caseData[i].convictions / race_pop) * 1000) > 50) { return q4; }
              if (((caseData[i].convictions / race_pop) * 1000) > 25) { return q3; }
              if (((caseData[i].convictions / race_pop) * 1000) > 10) { return q2; }
              if (((caseData[i].convictions / race_pop) * 1000) > 0) { return q1; }
		}
	    }
          }
       }


      }
         return none; 
        });
    });
 });
 });
}

d3.csv("data/county_race.csv", function(error, popData) {
    popData.forEach(function(d) {
        d.county = d.county;
	d.white = +d.white;
	d.black = +d.black;
	d.asian = +d.asian;
	d.pacific = +d.pacific;
	d.indian = +d.indian;
	d.hispanic = +d.hispanic;
	d.population = +d.population;
    });



d3.csv("data/cannabis_county_data.csv", function(error, csvData2) {
    csvData2.forEach(function(d) {
        d.race = d.race;
	d.county = d.county;
	d.convictions = +d.convictions;
	d.total = +d.total;
    });

d3.csv("data/cannabis_county_cases.csv", function(error, caseData) {
    csvData2.forEach(function(d) {
        d.race = d.race;
	d.county = d.county;
	d.cases = +d.cases;
	d.total = +d.total;
    });

race = "total";

var width = 600,
    height = 500,
    centered;

var projection = d3.geo.albersUsa()
    .scale(4200)
    .translate([100, 800]);

var path = d3.geo.path()
    .projection(projection);

var svg = d3.select("#map svg")
    .attr("width", width)
    .attr("height", height);

svg.append("rect")
    .attr("class", "background")
    .attr("width", width)
    //.on("click", clicked2)
    .attr("height", height);

var g = svg.append("g");

var districtInfo = document.getElementById('infobox');

districtInfo.innerHTML = "<div class='county_name'>Minnesota</div><div class='prevalence'>6.2 cannabis-related cases filed per 1,000 people</div>";

d3.json("shapefiles/counties.json", function(error, us) {

  g.append("g")
      .attr("id", "states")
    .selectAll("path")
      .data(us.features)
    .enter().append("path")
      .attr("d", path)
      .on("click", clicked)
      .style("fill", function(d){
      for (var i = 0; i < caseData.length; i++){
      if (race == "total"){
          if ((d.properties.COUNTYNAME == caseData[i].county)){
           for (var k = 0; k < popData.length; k++){
if (popData[k].county == d.properties.COUNTYNAME){
//console.log((caseData[i].total / popData[k].population) * 1000);
            if (((caseData[i].total / popData[k].population) * 1000) > 20 ) { return q5; }
            if (((caseData[i].total / popData[k].population) * 1000) > 15 ) { return q4; }
            if (((caseData[i].total / popData[k].population) * 1000) > 10 ) { return q3; }
            if (((caseData[i].total / popData[k].population) * 1000) > 5 ) { return q2; }
            if (((caseData[i].total / popData[k].population) * 1000) > 0 ) { return q1; }
}
    }
          }
       } else {
          if ((caseData[i].race == race) && (d.properties.COUNTYNAME == caseData[i].county)){
           for (var k = 0; k < popData.length; k++){
            if (popData[k].county == d.properties.COUNTYNAME){
                  if (race == "white"){var race_pop = popData[k].white; }
		  else if(race == "black"){var race_pop = popData[k].black; }
		  else if(race == "asian"){var race_pop = popData[k].asian; }
		  else if(race == "indian"){var race_pop = popData[k].indian; }
		  else if(race == "pacific"){var race_pop = popData[k].pacific; }
		  else if(race == "hispanic"){var race_pop = popData[k].hispanic; }

              if (((caseData[i].convictions / race_pop) * 1000) > 75) { return q5; }
              if (((caseData[i].convictions / race_pop) * 1000) > 50) { return q4; }
              if (((caseData[i].convictions / race_pop) * 1000) > 25) { return q3; }
              if (((caseData[i].convictions / race_pop) * 1000) > 10) { return q2; }
              if (((caseData[i].convictions / race_pop) * 1000) > 0) { return q1; }
		}
	    }
          }
       }


      }
         return none; 
        })
      .on("mousedown", function(d, i){

districtInfo.innerHTML = "<div class='county_name'>" + d.properties.COUNTYNAME + " County</div><div class='prevalence'>0 cannabis-related cases</div> ";

      for (var i = 0; i < caseData.length; i++){

      if (race == "total"){
          if ((d.properties.COUNTYNAME == caseData[i].county)){
           for (var k = 0; k < popData.length; k++){
if (popData[k].county == d.properties.COUNTYNAME){
var result = (caseData[i].total / popData[k].population) * 1000;
districtInfo.innerHTML = "<div class='county_name'>" + d.properties.COUNTYNAME + " County</div><div class='prevalence'>" + d3.round(result, 1) + " cannabis-related cases filed per 1,000 people</div>";
}
    }
          }
       } else {

        if ((caseData[i].race == race) && (d.properties.COUNTYNAME == caseData[i].county)){
           for (var k = 0; k < popData.length; k++){
             if (popData[k].county == d.properties.COUNTYNAME){
                  if (race == "white"){var race_pop = popData[k].white; var cons = caseData[i].convictions;}
      else if(race == "black"){var race_pop = popData[k].black; var cons = caseData[i].convictions;}
      else if(race == "asian"){var race_pop = popData[k].asian; var cons = caseData[i].convictions;}
      else if(race == "indian"){var race_pop = popData[k].indian; var cons = caseData[i].convictions;}
      else if(race == "pacific"){var race_pop = popData[k].pacific; var cons = caseData[i].convictions;}
      else if(race == "hispanic"){var race_pop = popData[k].hispanic; var cons = caseData[i].convictions;}

if (isFinite(caseData[i].convictions)){
var result = (cons / race_pop) * 1000;
districtInfo.innerHTML = "<div class='county_name'>" + d.properties.COUNTYNAME + " County</div><div class='prevalence'>" + d3.round(result, 1) + " cannabis-related cases filed per 1,000 " + race + " people</div>";
}
             }
     }
  }
      }
}
})
      .style("stroke-width", "1.5px")
      .style("stroke", "#fff")
      .call(d3.helper.tooltip(function(d, i){return "<b>" + d.properties.COUNTYNAME + " County</b>";}));

  g.append("path")
      //.datum(topojson.mesh(us, us.features, function(a, b) { return a !== b; }))
      .attr("id", "state-borders")
      .attr("d", path);
});



// zoom and pan
var zoom = d3.behavior.zoom()
    .on("zoom",function() {
        g.attr("transform","translate("+ 
            d3.event.translate.join(",")+")scale("+d3.event.scale+")");
        g.selectAll("circle")
            .attr("d", path.projection(projection));
        g.selectAll("path")  
            .attr("d", path.projection(projection)); 

  });

//svg.call(zoom);

$("ul li #sidebox #zoom").click(function() {
  clicked2();
});
$(".myButton2").mousedown(function() {
  clicked2();
});

function clicked(d) {
  var x, y, k;

  if (d && centered !== d) {
    var centroid = path.centroid(d);
    x = centroid[0];
    y = centroid[1];
    k = 4;
    centered = d;
  } else {
    x = width / 2;
    y = height / 2;
    k = 1;
    centered = null;
  }

  g.selectAll("path")
      .classed("faded", true)
      .classed("active", centered && function(d) { return d === centered; });

  g.transition()
      .duration(750)
      .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
      .style("stroke-width", 1.5 / k + "px");
}

function clicked2(d) {
  var x, y, k;
var districtInfo = document.getElementById('infobox');

    districtInfo.innerHTML = "<div class='county_name'>Minnesota</div><div class='prevalence'>6.2 cannabis-related cases filed per 1,000 people</div>";


  if (d && centered !== d) {
    var centroid = path.centroid(d);
    x = centroid[0];
    y = centroid[1];
    k = 1;
    centered = d;
  } else {
    x = width / 2;
    y = height / 2;
    k = 1;
    centered = null;
  }

  g.selectAll("path")
      .classed("faded", false)
      .classed("active", centered && function(d) { return d === centered; });

  g.transition()
      .duration(750)
.attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
      .style("stroke-width", 1.5 / k + "px");
}

});
});
});

</script>
<script>
d3.helper = {};

d3.helper.tooltip = function(accessor){
    return function(selection){
        var tooltipDiv;
        var bodyNode = d3.select('body').node();
        selection.on("mouseover", function(d, i){
            // Clean up lost tooltips
            d3.select('body').selectAll('div.tooltip').remove();
            // Append tooltip
            tooltipDiv = d3.select('body').append('div').attr('class', 'tooltip');
            var absoluteMousePos = d3.mouse(bodyNode);
            tooltipDiv.style('left', (absoluteMousePos[0] + 10)+'px')
                .style('top', (absoluteMousePos[1] - 15)+'px')
                .style('position', 'absolute') 
                .style('z-index', 1001);
            // Add text using the accessor function
            var tooltipText = accessor(d, i) || '';
            // Crop text arbitrarily
            //tooltipDiv.style('width', function(d, i){return (tooltipText.length > 80) ? '300px' : null;})
            //    .html(tooltipText);
        })
        .on('mousemove', function(d, i) {
            // Move tooltip
            var absoluteMousePos = d3.mouse(bodyNode);
            tooltipDiv.style('left', (absoluteMousePos[0] + 10)+'px')
                .style('top', (absoluteMousePos[1] - 15)+'px');
            var tooltipText = accessor(d, i) || '';
            tooltipDiv.html(tooltipText);
        })
        .on("mouseout", function(d, i){
            // Remove tooltip
            tooltipDiv.remove();
        });

    };
};
</script>

<script>

var white = "#edf8e9";
var black = "#c7e9c0";
var indian = "#a1d99b";
var hispanic = "#74c476";
var asian = "#31a354";
var other = "#006d2c";


$(document).ready(function() {
    cartogram1.init();
    cartogram2.init();
});

var tip2 = d3.tip()
  .attr('class', 'd3-tip')
  .offset([-10, 0])
  .html(function(d) {
    return "<strong>" + d.state_full + "</strong>";
  })

var cartogram1 = {
    margin: {
        top: 20,
        right: 0,
        bottom: 0,
        left: 0
    },

    selector: '#box1',

    init: function() {
        var self = this;

        self.$el = $(self.selector);

        self.width = 300 - self.margin.left - self.margin.right;
        self.height = 300 - self.margin.top - self.margin.bottom;

        self.svg = d3.select(self.selector).append('svg')
            .attr('height', self.height + self.margin.top + self.margin.bottom)
            .attr('width', self.width + self.margin.left + self.margin.right)

        self.state_size = self.width / 12;
        self.state_padding = 2;

        self.map = self.svg.append('g')
            .attr('transform', 'translate(' + self.margin.left + ','
                  + self.margin.top + ')')

        self.drawMap();
    },

    drawMap: function() {
        var self = this;

        var states = self.map.selectAll('.states')
            .data(self.grid_population)
            .enter().append('g')
            .attr('class', 'state-groups');

        var state = states.append('rect')
            .attr('id', function(d) {
                //return d.state_postal + "d";
            })
            .attr('class', 'state')
            .attr('class', function(d) {
                return d.color + " state-block";
            })
            .attr('rx', 2)
            .attr('ry', 2)
            .attr('x', function(d) {
                return d.column * (self.state_size + self.state_padding);
            })
            .attr('y', function(d) {
                return d.row * (self.state_size + self.state_padding);
            })
            .attr('width', self.state_size)
            .attr('height', self.state_size)
            .call(tip2)
            .on('mouseover', tip2.show)
             .on('mouseout', tip2.hide);

        var text = states.append('text')
            .attr('class', 'state-label')
            .attr('class', function(d) {
                return d.color;
            })
            .attr('dominant-baseline', 'central')
            .attr('x', function(d) {
                return (d.column * (self.state_size + self.state_padding))
                        + self.state_size / 2; })
            .attr('y', function(d) {
                return (d.row * (self.state_size + self.state_padding))
                    + self.state_size / 2; })
            .style('text-anchor', 'middle')
            .call(tip2)
            .on('mouseover', tip2.show)
             .on('mouseout', tip2.hide)
            .text(function(d) {
                return d.state_postal;
            });
    },

grid_population: [{'state_full':'white','state_postal':' ','row':0,'column':0,'color':'white'},
{'state_full':'white','state_postal':' ','row':0,'column':1,'color':'white'},
{'state_full':'white','state_postal':' ','row':0,'column':2,'color':'white'},
{'state_full':'white','state_postal':' ','row':0,'column':3,'color':'white'},
{'state_full':'white','state_postal':' ','row':0,'column':4,'color':'white'},
{'state_full':'white','state_postal':' ','row':0,'column':5,'color':'white'},
{'state_full':'white','state_postal':' ','row':0,'column':6,'color':'white'},
{'state_full':'white','state_postal':' ','row':0,'column':7,'color':'white'},
{'state_full':'white','state_postal':' ','row':0,'column':8,'color':'white'},
{'state_full':'white','state_postal':' ','row':0,'column':9,'color':'white'},
{'state_full':'white','state_postal':' ','row':1,'column':0,'color':'white'},
{'state_full':'white','state_postal':' ','row':1,'column':1,'color':'white'},
{'state_full':'white','state_postal':' ','row':1,'column':2,'color':'white'},
{'state_full':'white','state_postal':' ','row':1,'column':3,'color':'white'},
{'state_full':'white','state_postal':' ','row':1,'column':4,'color':'white'},
{'state_full':'white','state_postal':' ','row':1,'column':5,'color':'white'},
{'state_full':'white','state_postal':' ','row':1,'column':6,'color':'white'},
{'state_full':'white','state_postal':' ','row':1,'column':7,'color':'white'},
{'state_full':'white','state_postal':' ','row':1,'column':8,'color':'white'},
{'state_full':'white','state_postal':' ','row':1,'column':9,'color':'white'},
{'state_full':'white','state_postal':' ','row':2,'column':0,'color':'white'},
{'state_full':'white','state_postal':' ','row':2,'column':1,'color':'white'},
{'state_full':'white','state_postal':' ','row':2,'column':2,'color':'white'},
{'state_full':'white','state_postal':' ','row':2,'column':3,'color':'white'},
{'state_full':'white','state_postal':' ','row':2,'column':4,'color':'white'},
{'state_full':'white','state_postal':' ','row':2,'column':5,'color':'white'},
{'state_full':'white','state_postal':' ','row':2,'column':6,'color':'white'},
{'state_full':'white','state_postal':' ','row':2,'column':7,'color':'white'},
{'state_full':'white','state_postal':' ','row':2,'column':8,'color':'white'},
{'state_full':'white','state_postal':' ','row':2,'column':9,'color':'white'},
{'state_full':'white','state_postal':' ','row':3,'column':0,'color':'white'},
{'state_full':'white','state_postal':' ','row':3,'column':1,'color':'white'},
{'state_full':'white','state_postal':' ','row':3,'column':2,'color':'white'},
{'state_full':'white','state_postal':' ','row':3,'column':3,'color':'white'},
{'state_full':'white','state_postal':' ','row':3,'column':4,'color':'white'},
{'state_full':'white','state_postal':' ','row':3,'column':5,'color':'white'},
{'state_full':'white','state_postal':' ','row':3,'column':6,'color':'white'},
{'state_full':'white','state_postal':' ','row':3,'column':7,'color':'white'},
{'state_full':'white','state_postal':' ','row':3,'column':8,'color':'white'},
{'state_full':'white','state_postal':' ','row':3,'column':9,'color':'white'},
{'state_full':'white','state_postal':' ','row':4,'column':0,'color':'white'},
{'state_full':'white','state_postal':' ','row':4,'column':1,'color':'white'},
{'state_full':'white','state_postal':' ','row':4,'column':2,'color':'white'},
{'state_full':'white','state_postal':' ','row':4,'column':3,'color':'white'},
{'state_full':'white','state_postal':' ','row':4,'column':4,'color':'white'},
{'state_full':'white','state_postal':' ','row':4,'column':5,'color':'white'},
{'state_full':'white','state_postal':' ','row':4,'column':6,'color':'white'},
{'state_full':'white','state_postal':' ','row':4,'column':7,'color':'white'},
{'state_full':'white','state_postal':' ','row':4,'column':8,'color':'white'},
{'state_full':'white','state_postal':' ','row':4,'column':9,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':0,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':1,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':2,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':3,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':4,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':5,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':6,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':7,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':8,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':9,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':0,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':1,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':2,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':3,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':4,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':5,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':6,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':7,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':8,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':9,'color':'white'},
{'state_full':'white','state_postal':' ','row':6,'column':0,'color':'white'},
{'state_full':'white','state_postal':' ','row':6,'column':1,'color':'white'},
{'state_full':'white','state_postal':' ','row':6,'column':2,'color':'white'},
{'state_full':'white','state_postal':' ','row':6,'column':3,'color':'white'},
{'state_full':'white','state_postal':' ','row':6,'column':4,'color':'white'},
{'state_full':'white','state_postal':' ','row':6,'column':5,'color':'white'},
{'state_full':'white','state_postal':' ','row':6,'column':6,'color':'white'},
{'state_full':'white','state_postal':' ','row':6,'column':7,'color':'white'},
{'state_full':'white','state_postal':' ','row':6,'column':8,'color':'white'},
{'state_full':'white','state_postal':' ','row':6,'column':9,'color':'white'},
{'state_full':'white','state_postal':' ','row':7,'column':0,'color':'white'},
{'state_full':'white','state_postal':' ','row':7,'column':1,'color':'white'},
{'state_full':'white','state_postal':' ','row':7,'column':2,'color':'white'},
{'state_full':'white','state_postal':' ','row':7,'column':3,'color':'white'},
{'state_full':'white','state_postal':' ','row':7,'column':4,'color':'white'},
{'state_full':'white','state_postal':' ','row':7,'column':5,'color':'white'},
{'state_full':'white','state_postal':' ','row':7,'column':6,'color':'white'},
{'state_full':'white','state_postal':' ','row':7,'column':7,'color':'white'},
{'state_full':'white','state_postal':' ','row':7,'column':8,'color':'white'},
{'state_full':'white','state_postal':' ','row':7,'column':9,'color':'white'},
{'state_full':'white','state_postal':' ','row':8,'column':0,'color':'white'},
{'state_full':'black','state_postal':' ','row':8,'column':1,'color':'black'},
{'state_full':'black','state_postal':' ','row':8,'column':2,'color':'black'},
{'state_full':'black','state_postal':' ','row':8,'column':3,'color':'black'},
{'state_full':'black','state_postal':' ','row':8,'column':4,'color':'black'},
{'state_full':'black','state_postal':' ','row':8,'column':5,'color':'black'},
{'state_full':'black','state_postal':' ','row':8,'column':6,'color':'black'},
{'state_full':'hispanic','state_postal':' ','row':8,'column':7,'color':'hispanic'},
{'state_full':'hispanic','state_postal':' ','row':8,'column':8,'color':'hispanic'},
{'state_full':'hispanic','state_postal':' ','row':8,'column':9,'color':'hispanic'},
{'state_full':'hispanic','state_postal':' ','row':9,'column':0,'color':'hispanic'},
{'state_full':'hispanic','state_postal':' ','row':9,'column':1,'color':'hispanic'},
{'state_full':'indian','state_postal':' ','row':9,'column':2,'color':'indian'},
{'state_full':'asian','state_postal':' ','row':9,'column':3,'color':'asian'},
{'state_full':'asian','state_postal':' ','row':9,'column':4,'color':'asian'},
{'state_full':'asian','state_postal':' ','row':9,'column':5,'color':'asian'},
{'state_full':'asian','state_postal':' ','row':9,'column':6,'color':'asian'},
{'state_full':'asian','state_postal':' ','row':9,'column':7,'color':'asian'},
{'state_full':'other','state_postal':' ','row':9,'column':8,'color':'other'},
{'state_full':'other','state_postal':' ','row':9,'column':9,'color':'other'}
]

};

var cartogram2 = {
    margin: {
        top: 20,
        right: 0,
        bottom: 0,
        left: 0
    },

    selector: '#box2',

    init: function() {
        var self = this;

        self.$el = $(self.selector);

        self.width = 300 - self.margin.left - self.margin.right;
        self.height = 300 - self.margin.top - self.margin.bottom;

        self.svg = d3.select(self.selector).append('svg')
            .attr('height', self.height + self.margin.top + self.margin.bottom)
            .attr('width', self.width + self.margin.left + self.margin.right)

        self.state_size = self.width / 12;
        self.state_padding = 2;

        self.map = self.svg.append('g')
            .attr('transform', 'translate(' + self.margin.left + ','
                  + self.margin.top + ')')

        self.drawMap();
    },

    drawMap: function() {
        var self = this;

        var states = self.map.selectAll('.states')
            .data(self.grid_cases)
            .enter().append('g')
            .attr('class', 'state-groups');

        var state = states.append('rect')
            .attr('id', function(d) {
                return d.state_postal + "d";
            })
            .attr('class', 'state')
            .attr('class', function(d) {
                return d.color + " state-block";
            })
            .attr('rx', 2)
            .attr('ry', 2)
            .attr('x', function(d) {
                return d.column * (self.state_size + self.state_padding);
            })
            .attr('y', function(d) {
                return d.row * (self.state_size + self.state_padding);
            })
            .attr('width', self.state_size)
            .attr('height', self.state_size)
            .call(tip2)
            .on('mouseover', tip2.show)
             .on('mouseout', tip2.hide);

        var text = states.append('text')
            .attr('class', 'state-label')
            .attr('class', function(d) {
                return d.color;
            })
            .attr('dominant-baseline', 'central')
            .attr('x', function(d) {
                return (d.column * (self.state_size + self.state_padding))
                        + self.state_size / 2; })
            .attr('y', function(d) {
                return (d.row * (self.state_size + self.state_padding))
                    + self.state_size / 2; })
            .style('text-anchor', 'middle')
            .call(tip2)
            .on('mouseover', tip2.show)
             .on('mouseout', tip2.hide)
            .text(function(d) {
                return d.state_postal;
            });
    },

    grid_cases: [{'state_full':'white','state_postal':' ','row':0,'column':0,'color':'white'},
{'state_full':'white','state_postal':' ','row':0,'column':1,'color':'white'},
{'state_full':'white','state_postal':' ','row':0,'column':2,'color':'white'},
{'state_full':'white','state_postal':' ','row':0,'column':3,'color':'white'},
{'state_full':'white','state_postal':' ','row':0,'column':4,'color':'white'},
{'state_full':'white','state_postal':' ','row':0,'column':5,'color':'white'},
{'state_full':'white','state_postal':' ','row':0,'column':6,'color':'white'},
{'state_full':'white','state_postal':' ','row':0,'column':7,'color':'white'},
{'state_full':'white','state_postal':' ','row':0,'column':8,'color':'white'},
{'state_full':'white','state_postal':' ','row':0,'column':9,'color':'white'},
{'state_full':'white','state_postal':' ','row':1,'column':0,'color':'white'},
{'state_full':'white','state_postal':' ','row':1,'column':1,'color':'white'},
{'state_full':'white','state_postal':' ','row':1,'column':2,'color':'white'},
{'state_full':'white','state_postal':' ','row':1,'column':3,'color':'white'},
{'state_full':'white','state_postal':' ','row':1,'column':4,'color':'white'},
{'state_full':'white','state_postal':' ','row':1,'column':5,'color':'white'},
{'state_full':'white','state_postal':' ','row':1,'column':6,'color':'white'},
{'state_full':'white','state_postal':' ','row':1,'column':7,'color':'white'},
{'state_full':'white','state_postal':' ','row':1,'column':8,'color':'white'},
{'state_full':'white','state_postal':' ','row':1,'column':9,'color':'white'},
{'state_full':'white','state_postal':' ','row':2,'column':0,'color':'white'},
{'state_full':'white','state_postal':' ','row':2,'column':1,'color':'white'},
{'state_full':'white','state_postal':' ','row':2,'column':2,'color':'white'},
{'state_full':'white','state_postal':' ','row':2,'column':3,'color':'white'},
{'state_full':'white','state_postal':' ','row':2,'column':4,'color':'white'},
{'state_full':'white','state_postal':' ','row':2,'column':5,'color':'white'},
{'state_full':'white','state_postal':' ','row':2,'column':6,'color':'white'},
{'state_full':'white','state_postal':' ','row':2,'column':7,'color':'white'},
{'state_full':'white','state_postal':' ','row':2,'column':8,'color':'white'},
{'state_full':'white','state_postal':' ','row':2,'column':9,'color':'white'},
{'state_full':'white','state_postal':' ','row':3,'column':0,'color':'white'},
{'state_full':'white','state_postal':' ','row':3,'column':1,'color':'white'},
{'state_full':'white','state_postal':' ','row':3,'column':2,'color':'white'},
{'state_full':'white','state_postal':' ','row':3,'column':3,'color':'white'},
{'state_full':'white','state_postal':' ','row':3,'column':4,'color':'white'},
{'state_full':'white','state_postal':' ','row':3,'column':5,'color':'white'},
{'state_full':'white','state_postal':' ','row':3,'column':6,'color':'white'},
{'state_full':'white','state_postal':' ','row':3,'column':7,'color':'white'},
{'state_full':'white','state_postal':' ','row':3,'column':8,'color':'white'},
{'state_full':'white','state_postal':' ','row':3,'column':9,'color':'white'},
{'state_full':'white','state_postal':' ','row':4,'column':0,'color':'white'},
{'state_full':'white','state_postal':' ','row':4,'column':1,'color':'white'},
{'state_full':'white','state_postal':' ','row':4,'column':2,'color':'white'},
{'state_full':'white','state_postal':' ','row':4,'column':3,'color':'white'},
{'state_full':'white','state_postal':' ','row':4,'column':4,'color':'white'},
{'state_full':'white','state_postal':' ','row':4,'column':5,'color':'white'},
{'state_full':'white','state_postal':' ','row':4,'column':6,'color':'white'},
{'state_full':'white','state_postal':' ','row':4,'column':7,'color':'white'},
{'state_full':'white','state_postal':' ','row':4,'column':8,'color':'white'},
{'state_full':'white','state_postal':' ','row':4,'column':9,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':0,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':1,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':2,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':3,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':4,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':5,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':6,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':7,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':8,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':9,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':0,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':1,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':2,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':3,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':4,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':5,'color':'white'},
{'state_full':'white','state_postal':' ','row':5,'column':6,'color':'white'},
{'state_full':'black','state_postal':' ','row':5,'column':7,'color':'black'},
{'state_full':'black','state_postal':' ','row':5,'column':8,'color':'black'},
{'state_full':'black','state_postal':' ','row':5,'column':9,'color':'black'},
{'state_full':'black','state_postal':' ','row':6,'column':0,'color':'black'},
{'state_full':'black','state_postal':' ','row':6,'column':1,'color':'black'},
{'state_full':'black','state_postal':' ','row':6,'column':2,'color':'black'},
{'state_full':'black','state_postal':' ','row':6,'column':3,'color':'black'},
{'state_full':'black','state_postal':' ','row':6,'column':4,'color':'black'},
{'state_full':'black','state_postal':' ','row':6,'column':5,'color':'black'},
{'state_full':'black','state_postal':' ','row':6,'column':6,'color':'black'},
{'state_full':'black','state_postal':' ','row':6,'column':7,'color':'black'},
{'state_full':'black','state_postal':' ','row':6,'column':8,'color':'black'},
{'state_full':'black','state_postal':' ','row':6,'column':9,'color':'black'},
{'state_full':'black','state_postal':' ','row':7,'column':0,'color':'black'},
{'state_full':'black','state_postal':' ','row':7,'column':1,'color':'black'},
{'state_full':'black','state_postal':' ','row':7,'column':2,'color':'black'},
{'state_full':'black','state_postal':' ','row':7,'column':3,'color':'black'},
{'state_full':'hispanic','state_postal':' ','row':7,'column':4,'color':'hispanic'},
{'state_full':'hispanic','state_postal':' ','row':7,'column':5,'color':'hispanic'},
{'state_full':'hispanic','state_postal':' ','row':7,'column':6,'color':'hispanic'},
{'state_full':'hispanic','state_postal':' ','row':7,'column':7,'color':'hispanic'},
{'state_full':'hispanic','state_postal':' ','row':7,'column':8,'color':'hispanic'},
{'state_full':'indian','state_postal':' ','row':7,'column':9,'color':'indian'},
{'state_full':'indian','state_postal':' ','row':8,'column':0,'color':'indian'},
{'state_full':'indian','state_postal':' ','row':8,'column':1,'color':'indian'},
{'state_full':'indian','state_postal':' ','row':8,'column':2,'color':'indian'},
{'state_full':'indian','state_postal':' ','row':8,'column':3,'color':'indian'},
{'state_full':'indian','state_postal':' ','row':8,'column':4,'color':'indian'},
{'state_full':'asian','state_postal':' ','row':8,'column':5,'color':'asian'},
{'state_full':'asian','state_postal':' ','row':8,'column':6,'color':'asian'},
{'state_full':'other','state_postal':' ','row':8,'column':7,'color':'other'},
{'state_full':'other','state_postal':' ','row':8,'column':8,'color':'other'},
{'state_full':'other','state_postal':' ','row':8,'column':9,'color':'other'},
{'state_full':'other','state_postal':' ','row':9,'column':0,'color':'other'},
{'state_full':'other','state_postal':' ','row':9,'column':1,'color':'other'},
{'state_full':'other','state_postal':' ','row':9,'column':2,'color':'other'},
{'state_full':'other','state_postal':' ','row':9,'column':3,'color':'other'},
{'state_full':'other','state_postal':' ','row':9,'column':4,'color':'other'},
{'state_full':'other','state_postal':' ','row':9,'column':5,'color':'other'},
{'state_full':'other','state_postal':' ','row':9,'column':6,'color':'other'},
{'state_full':'other','state_postal':' ','row':9,'column':7,'color':'other'},
{'state_full':'other','state_postal':' ','row':9,'column':8,'color':'other'},
{'state_full':'other','state_postal':' ','row':9,'column':9,'color':'other'}
]

};


</script>

<script>
var width = 630,
    height = 300,
    centered;

var projection3 = d3.geo.albersUsa()
    .scale(157000)
    .translate([-6100, 17600]);

var path3 = d3.geo.path()
    .projection(projection3);

var svg3 = d3.select("#map3").append("svg")
    .attr("width", width)
    .attr("height", height);

svg3.append("rect")
    .attr("class", "background")
    .attr("width", width)
    //.on("click", clicked2)
    .attr("height", height);

var g3 = svg3.append("g");


d3.json("shapefiles/mpls.json", function(error, us) {
  g3.append("g")
      .attr("id", "mpls")
    .selectAll("path")
      .data(us.features)
    .enter().append("path")
      .attr("d", path3)
      .on("click", clicked)
      .style("fill", "#ddd")
      .style("stroke-width", "1.5px")
      .style("stroke", "#fff")
      .call(d3.helper.tooltip(function(d, i){return "<b>" + d.properties.Name + "</b>";}));

  g3.append("path")
      //.datum(topojson.mesh(us, us.features, function(a, b) { return a !== b; }))
      .attr("id", "mpls-borders")
      .attr("d", path3);
});


// zoom and pan
var zoom = d3.behavior.zoom()
    .on("zoom",function() {
        g.attr("transform","translate("+ 
            d3.event.translate.join(",")+")scale("+d3.event.scale+")");
        g.selectAll("circle")
            .attr("d", path.projection(projection));
        g.selectAll("path")  
            .attr("d", path.projection(projection)); 

  });

//svg.call(zoom);

$("#zoom").click(function() {
  clicked2();
});
$(".myButton2").mousedown(function() {
  clicked2();
});

function clicked(d) {
  var x, y, k;

  if (d && centered !== d) {
    var centroid = path.centroid(d);
    x = centroid[0];
    y = centroid[1];
    k = 4;
    centered = d;
  } else {
    x = width / 2;
    y = height / 2;
    k = 1;
    centered = null;
  }

  g3.selectAll("path")
      .classed("faded", true)
      .classed("active", centered && function(d) { return d === centered; });

  g3.transition()
      .duration(750)
      .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
      .style("stroke-width", 1.5 / k + "px");
}

function clicked2(d) {
  var x, y, k;
var districtInfo = document.getElementById('infobox');

    districtInfo.innerHTML = "";


  if (d && centered !== d) {
    var centroid = path.centroid(d);
    x = centroid[0];
    y = centroid[1];
    k = 1;
    centered = d;
  } else {
    x = width / 2;
    y = height / 2;
    k = 1;
    centered = null;
  }

  g3.selectAll("path")
      .classed("faded", false)
      .classed("active", centered && function(d) { return d === centered; });

  g3.transition()
      .duration(750)
.attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
      .style("stroke-width", 1.5 / k + "px");
}
</script>

<script>


$(document).ready(function() {
    cartogram4.init();
});

var tip3 = d3.tip()
   .attr('class', 'd3-tip')
   .offset([-10, 0])
   .html(function(d) {
     return "<strong>" + d.state_full + "</strong>";
   })

var cartogram4 = {
    margin: {
        top: 80,
        right: -110,
        bottom: 30,
        left: 250
    },

    selector: '#map2',

    init: function() {
        var self = this;

        self.$el = $(self.selector);

        self.width = 605 - self.margin.left - self.margin.right;
        self.height = 265 - self.margin.top - self.margin.bottom;

        self.svg = d3.select(self.selector).append('svg')
            .attr('height', self.height + self.margin.top + self.margin.bottom)
            .attr('width', self.width + self.margin.left + self.margin.right)

        self.state_size = self.width / 12;
        self.state_padding = 2;

        self.map = self.svg.append('g')
            .attr('transform', 'translate(' + self.margin.left + ','
                  + self.margin.top + ')')

        self.drawMap();
    },

    drawMap: function() {
        var self = this;

        var states = self.map.selectAll('.states')
            .data(self.state_legal)
            .enter().append('g')
            .attr('class', 'state-groups');

        var state = states.append('rect')
            .attr('id', function(d) {
                return d.state_postal + "d";
            })
            .attr('class', 'state')

            .attr('class', function(d) {
                return d.color;
            })
            .attr('rx', 2)
            .attr('ry', 2)
            .attr('x', function(d) {
                return d.column * (self.state_size + self.state_padding);
            })
            .attr('y', function(d) {
                return d.row * (self.state_size + self.state_padding);
            })
            .attr('width', self.state_size)
            .attr('height', self.state_size)
            .attr('criminal', function(d) {
                return d.criminal;
            })
            .call(tip3)
            .on('mouseover', tip3.show)
             .on('mouseout', tip3.hide);

        var text = states.append('text')
            .attr('class', 'state-label')
            .attr('class', function(d) {
                return d.color;
            })
            .attr('dominant-baseline', 'central')
            .attr('x', function(d) {
                return (d.column * (self.state_size + self.state_padding))
                        + self.state_size / 2; })
            .attr('y', function(d) {
                return (d.row * (self.state_size + self.state_padding))
                    + self.state_size / 2; })
            .style('text-anchor', 'middle')
            .call(tip2)
            .on('mouseover', tip3.show)
             .on('mouseout', tip3.hide)
            .text(function(d) {
                return d.state_postal;
            });
    },

state_legal: [{'state_full':'Alabama','state_postal':'AL','row':5,'column':6,'state_total':'No laws legalizing marijuana','color':'dq0'},
        {'state_full':'Alaska','state_postal':'AK','row':6,'column':0,'state_total':'Marijuana legalized for recreational use','color':'dq3','criminal':'yes'},
        {'state_full':'Arizona','state_postal':'AZ','row':4,'column':1,'state_total':'Marijuana legalized for medical use','color':'dq2','criminal':'yes'},
        {'state_full':'Arkansas','state_postal':'AR','row':4,'column':4,'state_total':'Marijuana legalized for medical use','color':'dq2','criminal':'yes'},
        {'state_full':'California','state_postal':'CA*','row':3,'column':0,'state_total':'No laws legalizing marijuana','color':'dq2','criminal':'no'},
        {'state_full':'Colorado','state_postal':'CO','row':3,'column':2,'state_total':'Marijuana legalized for recreational use','color':'dq3','criminal':'yes'},
        {'state_full':'Connecticut','state_postal':'CT*','row':2,'column':9,'state_total':'Marijuana legalized for medical use','color':'dq2','criminal':'no'},
        {'state_full':'District of Columbia','state_postal':'DC','row':4,'column':8,'state_total':'Marijuana legalized for medical use','color':'dq3','criminal':'yes'},
        {'state_full':'Delaware','state_postal':'DE','row':3,'column':9,'state_total':'Marijuana legalized for medical use','color':'dq2','criminal':'yes'},
        {'state_full':'Florida','state_postal':'FL','row':6,'column':8,'state_total':'No laws legalizing marijuana','color':'dq0','criminal':'yes'},
        {'state_full':'Georgia','state_postal':'GA','row':5,'column':7,'state_total':'No laws legalizing marijuana','color':'dq1','criminal':'yes'},
        {'state_full':'Hawaii','state_postal':'HI','row':6,'column':-1,'state_total':'Marijuana legalized for medical use','color':'dq2','criminal':'yes'},
        {'state_full':'Idaho','state_postal':'ID','row':1,'column':1,'state_total':'No laws legalizing marijuana','color':'dq1','criminal':'yes'},
        {'state_full':'Illinois','state_postal':'IL','row':1,'column':6,'state_total':'Marijuana legalized for medical use','color':'dq2','criminal':'yes'},
        {'state_full':'Indiana','state_postal':'IN','row':2,'column':5,'state_total':'No laws legalizing marijuana','color':'dq1','criminal':'yes'},
        {'state_full':'Iowa','state_postal':'IA','row':2,'column':4,'state_total':'No laws legalizing marijuana','color':'dq0','criminal':'yes'},
        {'state_full':'Kansas','state_postal':'KS','row':4,'column':3,'state_total':'No laws legalizing marijuana','color':'dq1','criminal':'yes'},
        {'state_full':'Kentucky','state_postal':'KY','row':3,'column':5,'state_total':'No laws legalizing marijuana','color':'dq0','criminal':'yes'},
        {'state_full':'Louisiana','state_postal':'LA','row':5,'column':4,'state_total':'No laws legalizing marijuana','color':'dq1','criminal':'yes'},
        {'state_full':'Maine','state_postal':'ME*','row':-1,'column':10,'state_total':'Marijuana legalized for medical use','color':'dq2','criminal':'no'},
        {'state_full':'Maryland','state_postal':'MD*','row':3,'column':8,'state_total':'Marijuana legalized for medical use','color':'dq2','criminal':'no'},
        {'state_full':'Massachusetts','state_postal':'MA*','row':1,'column':9,'state_total':'Marijuana legalized for medical use','color':'dq2','criminal':'no'},
        {'state_full':'Michigan','state_postal':'MI','row':1,'column':7,'state_total':'Marijuana legalized for medical use','color':'dq2','criminal':'yes'},
        {'state_full':'Minnesota','state_postal':'MN*','row':1,'column':4,'state_total':'Marijuana legalized for medical use','color':'dq2','criminal':'no'},
        {'state_full':'Mississippi','state_postal':'MS*','row':5,'column':5,'state_total':'No laws legalizing marijuana','color':'dq0','criminal':'no'},
        {'state_full':'Missouri','state_postal':'MO','row':3,'column':4,'state_total':'No laws legalizing marijuana','color':'dq0','criminal':'yes'},
        {'state_full':'Montana','state_postal':'MT','row':1,'column':2,'state_total':'Marijuana legalized for medical use','color':'dq2','criminal':'yes'},
        {'state_full':'Nebraska','state_postal':'NE*','row':3,'column':3,'state_total':'No laws legalizing marijuana','color':'dq1','criminal':'no'},
        {'state_full':'Nevada','state_postal':'NV*','row':2,'column':1,'state_total':'Marijuana legalized for medical use','color':'dq2','criminal':'no'},
        {'state_full':'New Hampshire','state_postal':'NH','row':0,'column':10,'state_total':'Marijuana legalized for medical use','color':'dq2','criminal':'yes'},
        {'state_full':'New Jersey','state_postal':'NJ','row':2,'column':8,'state_total':'No laws legalizing marijuana','color':'dq2','criminal':'yes'},
        {'state_full':'New Mexico','state_postal':'NM','row':4,'column':2,'state_total':'Marijuana legalized for medical use','color':'dq2','criminal':'yes'},
        {'state_full':'New York','state_postal':'NY*','row':1,'column':8,'state_total':'Marijuana legalized for medical use','color':'dq2','criminal':'no'},
        {'state_full':'North Carolina','state_postal':'NC*','row':4,'column':6,'state_total':'No laws legalizing marijuana','color':'dq0','criminal':'no'},
        {'state_full':'North Dakota','state_postal':'ND','row':1,'column':3,'state_total':'No laws legalizing marijuana','color':'dq1','criminal':'yes'},
        {'state_full':'Ohio','state_postal':'OH*','row':2,'column':6,'state_total':'No laws legalizing marijuana','color':'dq1','criminal':'no'},
        {'state_full':'Oklahoma','state_postal':'OK','row':5,'column':3,'state_total':'No laws legalizing marijuana','color':'dq1','criminal':'yes'},
        {'state_full':'Oregon','state_postal':'OR','row':2,'column':0,'state_total':'Marijuana legalized for recreational use','color':'dq3','criminal':'yes'},
        {'state_full':'Pennsylvania','state_postal':'PA','row':2,'column':7,'state_total':'No laws legalizing marijuana','color':'dq1','criminal':'yes'},
        {'state_full':'Rhode Island','state_postal':'RI*','row':2,'column':10,'state_total':'Marijuana legalized for medical use','color':'dq2','criminal':'no'},
        {'state_full':'South Carolina','state_postal':'SC','row':4,'column':7,'state_total':'No laws legalizing marijuana','color':'dq0','criminal':'yes'},
        {'state_full':'South Dakota','state_postal':'SD','row':2,'column':3,'state_total':'No laws legalizing marijuana','color':'dq1','criminal':'yes'},
        {'state_full':'Tennessee','state_postal':'TN','row':4,'column':5,'state_total':'No laws legalizing marijuana','color':'dq0','criminal':'yes'},
        {'state_full':'Texas','state_postal':'TX','row':6,'column':3,'state_total':'No laws legalizing marijuana','color':'dq1','criminal':'yes'},
        {'state_full':'Utah','state_postal':'UT','row':3,'column':1,'state_total':'No laws legalizing marijuana','color':'dq0','criminal':'yes'},
        {'state_full':'Vermont','state_postal':'VT*','row':0,'column':9,'state_total':'Marijuana legalized for medical use','color':'dq2','criminal':'no'},
        {'state_full':'Virginia','state_postal':'VA','row':3,'column':7,'state_total':'No laws legalizing marijuana','color':'dq0','criminal':'yes'},
        {'state_full':'Washington','state_postal':'WA','row':1,'column':0,'state_total':'Marijuana legalized for recreational use','color':'dq3','criminal':'yes'},
        {'state_full':'West Virginia','state_postal':'WV','row':3,'column':6,'state_total':'No laws legalizing marijuana','color':'dq1','criminal':'yes'},
        {'state_full':'Wisconsin','state_postal':'WI','row':1,'column':5,'state_total':'No laws legalizing marijuana','color':'dq0','criminal':'yes'},
        {'state_full':'Wyoming','state_postal':'WY','row':2,'column':2,'state_total':'No laws legalizing marijuana','color':'dq1','criminal':'yes'}]

};


</script>
<script>
var popInfo = document.getElementById('pop_pct');
var caseInfo = document.getElementById('case_pct');
var stateInfo = document.getElementById('description');

$( document ).ready(function() {
    $("#white").addClass("selectedButton");
    $(".indian").attr("class","indian faded2");
    $(".black").attr("class","black faded2");
    $(".hispanic").attr("class","hispanic faded2");
    $(".asian").attr("class","asian faded2");
    $(".other").attr("class","other faded2");
    $(".white").attr("class","white selectd");
    popInfo.innerHTML = "82";
    caseInfo.innerHTML = "57";
})
  $(".myButton4").click(function(){
    $(".myButton4").removeClass("selectedButton");
    $(this).addClass("selectedButton");
  });
  $("#white").click(function(){
    $(".indian").attr("class","indian faded2");
    $(".black").attr("class","black faded2");
    $(".hispanic").attr("class","hispanic faded2");
    $(".asian").attr("class","asian faded2");
    $(".other").attr("class","other faded2");
    $(".white").attr("class","white selectd");
    popInfo.innerHTML = "82";
    caseInfo.innerHTML = "57";
  });
  $("#black").click(function(){
    $(".indian").attr("class","indian faded2");
    $(".black").attr("class","black selectd");
    $(".hispanic").attr("class","hispanic faded2");
    $(".asian").attr("class","asian faded2");
    $(".other").attr("class","other faded2");
    $(".white").attr("class","white faded2");
    popInfo.innerHTML = "6";
    caseInfo.innerHTML = "17";
  });
  $("#hispanic").click(function(){
    $(".indian").attr("class","indian faded2");
    $(".black").attr("class","black faded2");
    $(".hispanic").attr("class","hispanic selectd");
    $(".asian").attr("class","asian faded2");
    $(".other").attr("class","other faded2");
    $(".white").attr("class","white faded2");
    popInfo.innerHTML = "5";
    caseInfo.innerHTML = "5";
  });
  $("#native").click(function(){
    $(".indian").attr("class","indian selectd");
    $(".black").attr("class","black faded2");
    $(".hispanic").attr("class","hispanic faded2");
    $(".asian").attr("class","asian faded2");
    $(".other").attr("class","other faded2");
    $(".white").attr("class","white faded2");
    popInfo.innerHTML = "1";
    caseInfo.innerHTML = "6";
    conInfo.innerHTML = "6";
  });
  $("#asian").click(function(){
    $(".indian").attr("class","indian faded2");
    $(".black").attr("class","black faded2");
    $(".hispanic").attr("class","hispanic faded2");
    $(".asian").attr("class","asian selectd");
    $(".other").attr("class","other faded2");
    $(".white").attr("class","white faded2");
    popInfo.innerHTML = "5";
    caseInfo.innerHTML = "2";
  });
  $("#other").click(function(){
    $(".indian").attr("class","indian faded2");
    $(".black").attr("class","black faded2");
    $(".hispanic").attr("class","hispanic faded2");
    $(".asian").attr("class","asian faded2");
    $(".other").attr("class","other selectd");
    $(".white").attr("class","white faded2");
    popInfo.innerHTML = "2";
    caseInfo.innerHTML = "13";
  });
    $("#decriminalized").click(function(){
    $(".dq1").attr("class","dq1 faded2");
    $(".dq2").attr("class","dq2 faded2");
    $(".dq3").attr("class","dq3 faded2");
    $(".dq0").attr("class","dq0 faded2");
    $(".dq1[criminal='no']").attr("class","dq1");
    $(".dq2[criminal='no']").attr("class","dq2");
    $(".dq3[criminal='no']").attr("class","dq3");
    $(".dq0[criminal='no']").attr("class","dq0");
    stateInfo.innerHTML = "While remaining recreationally illegal, marijuana is decriminalized in some states where first-time possession is typically treated as a minor violation.";
  });
  $("#oil").click(function(){
    $(".dq1").attr("class","dq1 faded2");
    $(".dq2").attr("class","dq2 faded2");
    $(".dq3").attr("class","dq3 faded2");
    $(".dq0").attr("class","dq0");
    stateInfo.innerHTML = "Some states have legalized non-psychoactive cannabidoil for very specific medical treatments while other marijuana strains remain illegal.";
  });
  $("#illegal").click(function(){
    $(".dq0").attr("class","dq0");
    $(".dq1").attr("class","dq1");
    $(".dq2").attr("class","dq2 faded2");
    $(".dq3").attr("class","dq3 faded2");
     stateInfo.innerHTML = "Marijuana remains illegal to sell or use in any substantial quantity in many states, even while some have certain exceptions.";
  });
  $("#medical").click(function(){
    $(".dq0").attr("class","dq0 faded2");
    $(".dq1").attr("class","dq1 faded2");
    $(".dq2").attr("class","dq2");
    $(".dq3").attr("class","dq3 faded2");
     stateInfo.innerHTML = "Some states have passed laws of varying strictness allowing the use of medical marijuana, while recreational use and sale remains illegal.";
  });
  $("#legal").click(function(){
    $(".dq0").attr("class","dq0 faded2");
    $(".dq1").attr("class","dq1 faded2");
    $(".dq2").attr("class","dq2 faded2");
    $(".dq3").attr("class","dq3");
     stateInfo.innerHTML = "A handful of states have legalized  marijuana for recreational and medical use under a varying set of rules, while others consider following suit.";
  });
  $("#reset").click(function(){
    $(".dq0").attr("class","dq0");
    $(".dq1").attr("class","dq1");
    $(".dq2").attr("class","dq2");
    $(".dq3").attr("class","dq3");
     stateInfo.innerHTML = "Marijuana's legal status has quickly transformed in various ways across the country.";
  });
</script>
</html>
