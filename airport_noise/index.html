<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Minneapolis Airport Noise</title>
  <meta name="description" content="Minneapolis Airport Noise">
  <meta name="author" content="Frey Hargarten - StarTribune">
  
  <link href="../_common_resources/charts/c3-master/c3.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="../_common_resources/styles/startribune_dataviz_styles.css" />
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.22.1/mapbox-gl.css' rel='stylesheet' />
  <link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v1.0.0/mapbox-gl-geocoder.css' type='text/css' />
  
  <style>
      body, #filter, #filter input:focus { font-family:"Benton Sans",Helvetica,Arial,sans-serif; }
      #chart .c3-line { stroke-width:6px !important; }

      #map { width:100%; height:400px; }
      #map_blocks { width:100%; height:600px; }
      .map-overlay-container { position: absolute; width:400px; top: 0; left: 0; padding: 10px; z-index: 1; }
      .map-overlay { font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif; background-color: #fff; border-radius: 3px; padding: 10px; box-shadow:0 1px 2px rgba(0,0,0,0.20); }
      .map-overlay h2, .map-overlay p { margin: 0 0 10px; }
      .mapboxgl-ctrl-attrib { display:none; }

      #wrapper { text-align:center; width:100%; }

      #viewSwitch, #current { padding:10px; }
      .stat { font-weight:900; }

      #filter { padding:12px; }

      #chart { height:250px; }

      .source { font-size:0.8em; }

      #blurb { text-align:center; padding:15px; }
      #visitors { font-weight:900; color:#66AF50; }
      #parkname { font-weight:900; }

      #filter input { border-radius:0 !important; width:100% !important; }
      #filter { padding:0px !important; }

      p { text-align:center; margin-right:auto; margin-left:auto; padding:15px; }

      #geocoder-container, #geocoder-container2 { width:100%; margin-top:10px; }
      #geocoder-container > div, #geocoder-container2 > div { min-width:100%; margin-left:0; }

      #parksList { height:164px; overflow:auto; }
      .zoom { float:none !important; text-align:center; padding:15px; }

      .switch { padding:10px; display:inline-block; text-align:center; width:100%; background-color:#fff; font-weight:900; font-family:"Benton Sans",Helvetica,Arial,sans-serif; border:1px solid black; color:#000 !important; margin:0 !important; }
      .switch:hover, .selected, .step:hover { background-color:#4C4C39 !important; color:#fff !important; cursor:pointer; margin:0 !important; }

      .play { background-color:#fff !important; color:#000; }
      .pause { background-color:#333 !important; color:#fff; }
      #diverse { color:#299129; }
   
      #toggle { margin:0; padding:0; width:80px; height:23px; font-size:2em; -moz-border-radius:0; -webkit-border-radius:0; border-radius:0; border:0; font-weight:900; margin-left:auto; margin-right:auto; display:block; }
      #toggle:hover { background-color:#333 !important; color:#fff; cursor:pointer; }
      .navButtons { display:block; text-align:center; background-color:#fff !important; width:40px; font-size:2em; -moz-border-radius:0; -webkit-border-radius:0; border-radius:0; border:0; font-weight:900; }
      .navButtons:hover { background-color:#333 !important; color:#fff; cursor:pointer; }
      .previous { float:left; }
      .next { float:right; }

      #tracker { padding-top:10px; text-align:center; }
      .trackDot { border-radius:50%; width:10px; height:10px; display:inline-block; margin:6px; background-color:#ddd; }
      .trackDot:hover, .current { background-color:#333; cursor:pointer; }
      .dot { border-radius:50%; width:15px; height:15px; text-align:center; margin-right:auto; margin-left:auto; }

      #box { text-align:center; }
      .legendBlock { width:246px; margin-left:auto; margin-right:auto; }

      .map-overlay-container { position:static; }
      .map-overlay { font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif; background-color: #fff; border-radius: 3px; padding: 10px; box-shadow:0 1px 2px rgba(0,0,0,0.20); }
      .map-overlay h2, .map-overlay p { margin: 0 0 10px; }

      .controls { display:inline-block; width:49.5% !important; vertical-align:top; }

      @media (max-width:500px) {
      #map_blocks { position:static; height:350px; }
      .map-overlay-container { width:100%; position:static; }
      .bottom { position:static; width:100%; clear:both; }
      .controls { display:block; width:100% !important; vertical-align:top; }
      }
  </style> 
</head>

<body>
<div id="time" class="dataviz">
<div id="map"></div>
<div id='geocoder-container'></div>

<div class="breaker"></div>

<div>
<div class='legendBlock'>
<span class='legend'>
  <nav class='legend clearfix'>
    <h4>Noise change since 2006</h4>
    <span style='background:#fff;'>Less</span>
    <span style='background:#2c7bb6;'></span>
    <span style='background:#abd9e9;'></span>
    <span style='background:#ffffbf'></span>
    <span style='background:#fdae61'></span>
    <span style='background:#d7191c'></span>
    <span style='background:#fff;'>More</span>
  </nav>
</span>
</div>

<div class="zoom">Reset View</div>
</div>

<div class="breaker"></div>
</div>

<div id="blocks" class="dataviz">
<div id="map_blocks"></div>
<div id='geocoder-container2'></div>

<div class="controls">
<h2 id="year" style="display:none;"></h2>

<div class='legendBlock'>
<span class='legend'>
  <nav class='legend clearfix'>
    <h5>Decibel noise level</h5>
    <span style='background:#fff;'>Less</span>
    <span style='background:#2c7bb6;'></span>
    <span style='background:#abd9e9;'></span>
    <span style='background:#ffffbf'></span>
    <span style='background:#fdae61'></span>
    <span style='background:#d7191c'></span>
    <span style='background:#fff;'>More</span>
  </nav>
</span>
</div>
</div>

<div class='map-overlay-container controls'>
<div class='map-overlay'>

<button class="previous navButtons">&lt;&lt;</button><button class="next navButtons">&gt;&gt;</button><button class="play myButton2" id="toggle">&#9658;</button>

<div id="tracker">
<div class="trackDot" id="d0" index="0" year="2011"></div>
<div class="trackDot" id="d1" index="1" year="2012"></div>
<div class="trackDot" id="d2" index="2" year="2013"></div>
<div class="trackDot" id="d3" index="3" year="2014"></div>
<div class="trackDot" id="d4" index="4" year="2015"></div>
<!-- <div class="trackDot" id="d5" index="5" year="2015"></div> -->
</div>

<div class="zoom">Reset View</div>
</div>

</div>

</div>
<!-- <p><small class="byline">Data Visualization by <a href="http://www.startribune.com/jeff-hargarten/274254381/" target="new_">Jeff Hargarten</a></small></p> -->

<script src="//code.jquery.com/jquery-latest.js"></script>
<script src="../_common_resources/js/d3-master/d3.min.js" charset="utf-8"></script>
<script src="../_common_resources/charts/c3-master/c3.min.js"></script>
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.22.1/mapbox-gl.js'></script>
<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v1.0.0/mapbox-gl-geocoder.js'></script>

<script>
//USE SOUNDCITE: https://soundcite.knightlab.com/#create-new

$.urlParam = function(name){
  var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
  if (results != null) { return results[1] || 0; }
  else { return null; }
}

var selected = $.urlParam('chart');

if (selected != null){
$(".dataviz").hide();
$("#" + selected).show();
}

d3.json('./shapefiles/blocks.json', function(error, blocks) {
d3.json('./shapefiles/noise.geojson', function(error, spots) {
d3.json('./shapefiles/blocks_ext.json', function(error, blocks_ext) {
d3.json('./shapefiles/contour2011.json', function(error, contours2011) {
d3.json('./shapefiles/contour2012.json', function(error, contours2012) {
d3.json('./shapefiles/contour2013.json', function(error, contours2013) {
d3.json('./shapefiles/contour2014.json', function(error, contours2014) {
d3.json('./shapefiles/contour2015.json', function(error, contours2015) {

//MAPPAGE
mapboxgl.accessToken = 'pk.eyJ1Ijoic2hhZG93ZmxhcmUiLCJhIjoiS3pwY1JTMCJ9.pTSXx_LFgR3XBpCNNxWPKA';
var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/shadowflare/ciqzo0bu20004bknkbrhrm6wf',
    center: [-93.216667, 44.860278],
    zoom: 10,
    minZoom: 2
});

var geocoder = new mapboxgl.Geocoder({
    container: 'geocoder-container' // Optional. Specify a unique container for the control to be added to.
});

map.scrollZoom.disable();
map.addControl(geocoder);
map.addControl(new mapboxgl.Navigation());

map.on('load', function() {
$(".mapboxgl-ctrl-geocoder input").attr("placeholder","Search by city or address");

$(".zoom").click(function() {
map.flyTo({ center: [-93.216667, 44.860278], zoom: 10 });
});

geocoder.on('result', function(ev) {
  map.flyTo({ center: ev.result.geometry.coordinates, zoom: 12 });
    });

    map.addSource("spots", {
        type: "geojson",
        data: spots
    });

    map.addLayer({
                "id": "spots-layer",
                "type": "circle",
                "source": "spots",
                "paint": {
                "circle-color": {
                property: 'time_over65',
                // type: 'categorical',
                stops: [
                    [-500000, '#2c7bb6'],
                    [-100000, '#abd9e9'],
                    [-1, '#ffffbf'],
                    [1, '#ffffbf'],
                    [10000, '#fdae61'],
                    [50000, '#d7191c']]
            },
                "circle-radius": {
                property: 'noise',
                // type: 'categorical',
                stops: [
                    [0, 3],
                    [100000, 5],
                    [300000, 7],
                    [500000, 9],
                    [1000000, 11]]
            }
                }
    });


});


var popup = new mapboxgl.Popup({
    closeButton: false,
    closeOnClick: false
});

map.on('mousemove', function(e) {
    var features = map.queryRenderedFeatures(e.point, { layers: ['spots-layer'] });
    // Change the cursor style as a UI indicator.
    map.getCanvas().style.cursor = (features.length) ? 'default' : '';

    if (!features.length) {
        popup.remove();
        return;
    }

    var feature = features[0];
    var reason = "";

    // Populate the popup and set its coordinates
    // based on the feature found.
    popup.setLngLat(e.lngLat)
        .setHTML("<div>" + feature.properties.city + "</div><div>" + feature.properties.address + "</div><div>" + d3.format(",+")(feature.properties.noise) + " milliseconds</div>")
        .addTo(map);
});


//MAPPAGE BLOCKS
mapboxgl.accessToken = 'pk.eyJ1Ijoic2hhZG93ZmxhcmUiLCJhIjoiS3pwY1JTMCJ9.pTSXx_LFgR3XBpCNNxWPKA';
var map2 = new mapboxgl.Map({
    container: 'map_blocks',
    style: 'mapbox://styles/shadowflare/ciqzo0bu20004bknkbrhrm6wf',
    center: [-93.179770, 44.877039],
    zoom: 11.5,
    minZoom: 2
});

var geocoder2 = new mapboxgl.Geocoder({
    container: 'geocoder-container2' // Optional. Specify a unique container for the control to be added to.
});

map2.scrollZoom.disable();
map2.addControl(geocoder2);
map2.addControl(new mapboxgl.Navigation());

map2.on('load', function() {
$(".mapboxgl-ctrl-geocoder input").attr("placeholder","Search by city or address");

geocoder2.on('result', function(ev) {
  map2.flyTo({ center: ev.result.geometry.coordinates, zoom: 14 });
    });


    map2.addSource("blocks", {
        type: "geojson",
        data: blocks
    });

    map2.addSource("blocks_ext", {
        type: "geojson",
        data: blocks_ext
    });

    map2.addSource("contours2011", {
        type: "geojson",
        data: contours2011
    });

    map2.addSource("contours2012", {
        type: "geojson",
        data: contours2012
    });

    map2.addSource("contours2013", {
        type: "geojson",
        data: contours2013
    });

    map2.addSource("contours2014", {
        type: "geojson",
        data: contours2014
    });

    map2.addSource("contours2015", {
        type: "geojson",
        data: contours2015
    });

//2010
    map2.addLayer({
                "id": "blocks-layer2010",
                "type": "fill",
                "source": "blocks",
                "paint": {
                'fill-antialias' : true,
                'fill-opacity': 1,
                'fill-outline-color': 'rgba(51, 51, 51, 1)',
                "fill-color": {
                property: 'A2010',
                // type: 'categorical',
                stops: [
                    [0, '#2c7bb6'],
                    [50, '#abd9e9'],
                    [55, '#ffffbf'],
                    [65, '#fdae61'],
                    [69, '#d7191c']]
            }
                }
    });

    map2.addLayer({
                "id": "blocks-layer-ext2010",
                "type": "fill",
                "source": "blocks_ext",
                "paint": {
                'fill-antialias' : true,
                'fill-opacity': 1,
                'fill-outline-color': 'rgba(51, 51, 51, 1)',
                "fill-color": {
                property: 'A2010',
                // type: 'categorical',
                stops: [
                    [0, '#2c7bb6'],
                    [50, '#abd9e9'],
                    [55, '#ffffbf'],
                    [65, '#fdae61'],
                    [69, '#d7191c']]
            }
                }
    });

//2011
    map2.addLayer({
                "id": "blocks-layer2011",
                "type": "fill",
                "source": "blocks",
                "paint": {
                'fill-antialias' : true,
                'fill-opacity': 1,
                'fill-outline-color': 'rgba(51, 51, 51, 1)',
                "fill-color": {
                property: 'A2011',
                // type: 'categorical',
                stops: [
                    [0, '#2c7bb6'],
                    [50, '#abd9e9'],
                    [55, '#ffffbf'],
                    [65, '#fdae61'],
                    [69, '#d7191c']]
            }
                }
    });

    map2.addLayer({
                "id": "blocks-layer-ext2011",
                "type": "fill",
                "source": "blocks_ext",
                "paint": {
                'fill-antialias' : true,
                'fill-opacity': 1,
                'fill-outline-color': 'rgba(51, 51, 51, 1)',
                "fill-color": {
                property: 'A2011',
                // type: 'categorical',
                stops: [
                    [0, '#2c7bb6'],
                    [50, '#abd9e9'],
                    [55, '#ffffbf'],
                    [65, '#fdae61'],
                    [69, '#d7191c']]
            }
                }
    });

    map2.addLayer({
                "id": "contour-layer2011",
                "type": "fill",
                "source": "contours2011",
                "paint": {
                "fill-antialias": true,
                "fill-color": 'rgba(0, 0, 0, 0)',
                // "fill-outline-opacity": 1,
                "fill-outline-color": "#000000"
                }
    });

//2012
    map2.addLayer({
                "id": "blocks-layer2012",
                "type": "fill",
                "source": "blocks",
                "paint": {
                'fill-antialias' : true,
                'fill-opacity': 1,
                'fill-outline-color': 'rgba(51, 51, 51, 1)',
                "fill-color": {
                property: 'A2012',
                // type: 'categorical',
                stops: [
                    [0, '#2c7bb6'],
                    [50, '#abd9e9'],
                    [55, '#ffffbf'],
                    [65, '#fdae61'],
                    [69, '#d7191c']]
            }
                }
    });

    map2.addLayer({
                "id": "blocks-layer-ext2012",
                "type": "fill",
                "source": "blocks_ext",
                "paint": {
                'fill-antialias' : true,
                'fill-opacity': 1,
                'fill-outline-color': 'rgba(51, 51, 51, 1)',
                "fill-color": {
                property: 'A2012',
                // type: 'categorical',
                stops: [
                    [0, '#2c7bb6'],
                    [50, '#abd9e9'],
                    [55, '#ffffbf'],
                    [65, '#fdae61'],
                    [69, '#d7191c']]
            }
                }
    });

    map2.addLayer({
                "id": "contour-layer2012",
                "type": "fill",
                "source": "contours2012",
                "paint": {
                "fill-antialias": true,
                "fill-color": 'rgba(0, 0, 0, 0)',
                // "fill-outline-opacity": 1,
                "fill-outline-color": "#000000"
                }
    });

//2013
    map2.addLayer({
                "id": "blocks-layer2013",
                "type": "fill",
                "source": "blocks",
                "paint": {
                'fill-antialias' : true,
                'fill-opacity': 1,
                'fill-outline-color': 'rgba(51, 51, 51, 1)',
                "fill-color": {
                property: 'A2013',
                // type: 'categorical',
                stops: [
                    [0, '#2c7bb6'],
                    [50, '#abd9e9'],
                    [55, '#ffffbf'],
                    [65, '#fdae61'],
                    [69, '#d7191c']]
            }
                }
    });

    map2.addLayer({
                "id": "blocks-layer-ext2013",
                "type": "fill",
                "source": "blocks_ext",
                "paint": {
                'fill-antialias' : true,
                'fill-opacity': 1,
                'fill-outline-color': 'rgba(51, 51, 51, 1)',
                "fill-color": {
                property: 'A2013',
                // type: 'categorical',
                stops: [
                    [0, '#2c7bb6'],
                    [50, '#abd9e9'],
                    [55, '#ffffbf'],
                    [65, '#fdae61'],
                    [69, '#d7191c']]
            }
                }
    });

    map2.addLayer({
                "id": "contour-layer2013",
                "type": "fill",
                "source": "contours2013",
                "paint": {
                "fill-antialias": true,
                "fill-color": 'rgba(0, 0, 0, 0)',
                // "fill-outline-opacity": 1,
                "fill-outline-color": "#000000"
                }
    });

//2014
    map2.addLayer({
                "id": "blocks-layer2014",
                "type": "fill",
                "source": "blocks",
                "paint": {
                'fill-antialias' : true,
                'fill-opacity': 1,
                'fill-outline-color': 'rgba(51, 51, 51, 1)',
                "fill-color": {
                property: 'A2014',
                // type: 'categorical',
                stops: [
                    [0, '#2c7bb6'],
                    [50, '#abd9e9'],
                    [55, '#ffffbf'],
                    [65, '#fdae61'],
                    [69, '#d7191c']]
            }
                }
    });

    map2.addLayer({
                "id": "blocks-layer-ext2014",
                "type": "fill",
                "source": "blocks_ext",
                "paint": {
                'fill-antialias' : true,
                'fill-opacity': 1,
                'fill-outline-color': 'rgba(51, 51, 51, 1)',
                "fill-color": {
                property: 'A2014',
                // type: 'categorical',
                stops: [
                    [0, '#2c7bb6'],
                    [50, '#abd9e9'],
                    [55, '#ffffbf'],
                    [65, '#fdae61'],
                    [69, '#d7191c']]
            }
                }
    });

    map2.addLayer({
                "id": "contour-layer2014",
                "type": "fill",
                "source": "contours2014",
                "paint": {
                "fill-antialias": true,
                "fill-color": 'rgba(0, 0, 0, 0)',
                // "fill-outline-opacity": 1,
                "fill-outline-color": "#000000"
                }
    });

//2015
    map2.addLayer({
                "id": "blocks-layer2015",
                "type": "fill",
                "source": "blocks",
                "paint": {
                'fill-antialias' : true,
                'fill-opacity': 1,
                'fill-outline-color': 'rgba(51, 51, 51, 1)',
                "fill-color": {
                property: 'A2015',
                // type: 'categorical',
                stops: [
                    [0, '#2c7bb6'],
                    [50, '#abd9e9'],
                    [55, '#ffffbf'],
                    [65, '#fdae61'],
                    [69, '#d7191c']]
            }
                }
    });

    map2.addLayer({
                "id": "blocks-layer-ext2015",
                "type": "fill",
                "source": "blocks_ext",
                "paint": {
                'fill-antialias' : true,
                'fill-opacity': 1,
                'fill-outline-color': 'rgba(51, 51, 51, 1)',
                "fill-color": {
                property: 'A2015',
                // type: 'categorical',
                stops: [
                    [0, '#2c7bb6'],
                    [50, '#abd9e9'],
                    [55, '#ffffbf'],
                    [65, '#fdae61'],
                    [69, '#d7191c']]
            }
                }
    });

    map2.addLayer({
                "id": "contour-layer2015",
                "type": "fill",
                "source": "contours2015",
                "paint": {
                "fill-antialias": true,
                "fill-color": 'rgba(0, 0, 0, 0)',
                // "fill-outline-opacity": 1,
                "fill-outline-color": "#000000"
                }
    });

var timer = [];

function playback(index,stream) {

    $(".trackDot").removeClass("current");
    $("#d" + index).addClass("current");
    $("#year").html($("#d" + index).attr("year"));

    // if (index == 0){
    // map2.setLayoutProperty('blocks-layer2010', 'visibility', 'visible');
    // map2.setLayoutProperty('blocks-layer2011', 'visibility', 'none');
    // map2.setLayoutProperty('blocks-layer2012', 'visibility', 'none');
    // map2.setLayoutProperty('blocks-layer2013', 'visibility', 'none');
    // map2.setLayoutProperty('blocks-layer2014', 'visibility', 'none');
    // map2.setLayoutProperty('blocks-layer2015', 'visibility', 'none');
    // map2.setLayoutProperty('blocks-layer-ext2010', 'visibility', 'visible');
    // map2.setLayoutProperty('blocks-layer-ext2011', 'visibility', 'none');
    // map2.setLayoutProperty('blocks-layer-ext2012', 'visibility', 'none');
    // map2.setLayoutProperty('blocks-layer-ext2013', 'visibility', 'none');
    // map2.setLayoutProperty('blocks-layer-ext2014', 'visibility', 'none');
    // map2.setLayoutProperty('blocks-layer-ext2015', 'visibility', 'none');
    // map2.setLayoutProperty('contour-layer2015', 'visibility', 'visible');
    // }
    if (index == 0){
    map2.setLayoutProperty('blocks-layer2010', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer2011', 'visibility', 'visible');
    map2.setLayoutProperty('blocks-layer2012', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer2013', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer2014', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer2015', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer-ext2010', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer-ext2011', 'visibility', 'visible');
    map2.setLayoutProperty('blocks-layer-ext2012', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer-ext2013', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer-ext2014', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer-ext2015', 'visibility', 'none');
    map2.setLayoutProperty('contour-layer2011', 'visibility', 'visible');
    map2.setLayoutProperty('contour-layer2012', 'visibility', 'none');
    map2.setLayoutProperty('contour-layer2013', 'visibility', 'none');
    map2.setLayoutProperty('contour-layer2014', 'visibility', 'none');
    map2.setLayoutProperty('contour-layer2015', 'visibility', 'none');
    }
    if (index == 1){
    map2.setLayoutProperty('blocks-layer2010', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer2011', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer2012', 'visibility', 'visible');
    map2.setLayoutProperty('blocks-layer2013', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer2014', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer2015', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer-ext2010', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer-ext2011', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer-ext2012', 'visibility', 'visible');
    map2.setLayoutProperty('blocks-layer-ext2013', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer-ext2014', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer-ext2015', 'visibility', 'none');
    map2.setLayoutProperty('contour-layer2011', 'visibility', 'none');
    map2.setLayoutProperty('contour-layer2012', 'visibility', 'visible');
    map2.setLayoutProperty('contour-layer2013', 'visibility', 'none');
    map2.setLayoutProperty('contour-layer2014', 'visibility', 'none');
    map2.setLayoutProperty('contour-layer2015', 'visibility', 'none');
    }
    else if (index == 2){
    map2.setLayoutProperty('blocks-layer2010', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer2011', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer2012', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer2013', 'visibility', 'visible');
    map2.setLayoutProperty('blocks-layer2014', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer2015', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer-ext2010', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer-ext2011', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer-ext2012', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer-ext2013', 'visibility', 'visible');
    map2.setLayoutProperty('blocks-layer-ext2014', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer-ext2015', 'visibility', 'none');
    map2.setLayoutProperty('contour-layer2015', 'visibility', 'visible');
    map2.setLayoutProperty('contour-layer2011', 'visibility', 'none');
    map2.setLayoutProperty('contour-layer2012', 'visibility', 'none');
    map2.setLayoutProperty('contour-layer2013', 'visibility', 'visible');
    map2.setLayoutProperty('contour-layer2014', 'visibility', 'none');
    map2.setLayoutProperty('contour-layer2015', 'visibility', 'none');
    }
    else if (index == 3){
    map2.setLayoutProperty('blocks-layer2010', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer2011', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer2012', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer2013', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer2014', 'visibility', 'visible');
    map2.setLayoutProperty('blocks-layer2015', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer-ext2010', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer-ext2011', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer-ext2012', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer-ext2013', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer-ext2014', 'visibility', 'visible');
    map2.setLayoutProperty('blocks-layer-ext2015', 'visibility', 'none');
    map2.setLayoutProperty('contour-layer2015', 'visibility', 'visible');
    map2.setLayoutProperty('contour-layer2011', 'visibility', 'none');
    map2.setLayoutProperty('contour-layer2012', 'visibility', 'none');
    map2.setLayoutProperty('contour-layer2013', 'visibility', 'none');
    map2.setLayoutProperty('contour-layer2014', 'visibility', 'visible');
    map2.setLayoutProperty('contour-layer2015', 'visibility', 'none');
    }
    else if (index == 4){
    map2.setLayoutProperty('blocks-layer2010', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer2011', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer2012', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer2013', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer2014', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer2015', 'visibility', 'visible');
    map2.setLayoutProperty('blocks-layer-ext2010', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer-ext2011', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer-ext2012', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer-ext2013', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer-ext2014', 'visibility', 'none');
    map2.setLayoutProperty('blocks-layer-ext2015', 'visibility', 'visible');
    map2.setLayoutProperty('contour-layer2015', 'visibility', 'visible');
    map2.setLayoutProperty('contour-layer2011', 'visibility', 'none');
    map2.setLayoutProperty('contour-layer2012', 'visibility', 'none');
    map2.setLayoutProperty('contour-layer2013', 'visibility', 'none');
    map2.setLayoutProperty('contour-layer2014', 'visibility', 'none');
    map2.setLayoutProperty('contour-layer2015', 'visibility', 'visible');
    }

}

playback(0);

function play(j,timeout){
 timer[j] = window.setTimeout(function() { playback(j); }, timeout); 
}

function stop(){
  for (var i=0; i<6; i++){
     clearTimeout(timer[i]);
  }
}

$(".trackDot").click(function() {
  $("#toggle").attr("class", "play myButton2");
  $("#toggle").html("&#9658;");
  $(".trackDot").removeClass("current");
  $(this).addClass("current");
  stop();
  index = Number($(this).attr("index"));
  playback(Number($(this).attr("index")));
});

    if ($(window).width() <= 500) { map2.flyTo({ center: [-93.208694, 44.883485], zoom: 10.6 }); }
    else { map2.flyTo({ center: [-93.179770, 44.877039], zoom: 11.5 }); }
    $(window).resize(function() {
    if ($(window).width() <= 500) { map2.flyTo({ center: [-93.208694, 44.883485], zoom: 10.6 }); }
    else { map2.flyTo({ center: [-93.179770, 44.877039], zoom: 11.5 }); }
    });

$(".zoom").click(function() {
map2.flyTo({ center: [-93.179770, 44.877039], zoom: 11.5 });
});

    var index = 0;
$(document).ready(function() {
        $('#toggle').bind("click", function() {
          if ($(this).attr("class") == "play myButton2") {
             $(this).attr("class", "pause myButton2");
             $(this).html("&#9724;");
             for (var j=0; j<5; j++){ play(j,j*2000); if (index < 5) { index++; } }
         }
          else {
             $(this).attr("class", "play myButton2");
             $(this).html("&#9658;");
             stop();
           }
        });
      });

$(".previous").click(function() {
  if (index > 0) {
  index--;
  stop();
  playback(index);
}
  });

$(".next").click(function() {
  if (index < 4) {
  stop();
  index++;
  playback(index);
}
  });

});


});
});
});
});
});
});
});
});
</script>
</body>
</html>